namespacer("baltimoreCounty.pageSpecific"),baltimoreCounty.pageSpecific.citySourcedViewer=function(e,t,i,o){"use strict";var n=function(t,i){e.ajax("//testservices.baltimorecountymd.gov/api/citysourced/getreportsbylatlng",{method:"POST",data:t}).done(function(e){i&&i(e)}).fail(function(e){})},r=function(e,t){var i=moment(e.Created),o=moment(t.Created);return i.isAfter(o)?-1:1},a=function(t,i,o){i&&i.length>o&&(t.find("li").not(function(e,t){return e<=o-1}).hide(),t.after('<p><a href="javascript:;" id="show-comments" aria-role="button">Load '+(i.length-o)+" more comments</a></p>"),e("#show-comments").on("click",function(){t.find("li").slideDown(500),e(this).hide()}))},c=function(e){if(e.DateCreated&&(e.DateCreated=d(e.DateCreated)),e.DateUpdated&&(e.DateUpdated=d(e.DateUpdated)),e.Comments)for(var t=0;t<e.Comments.length;t++)e.Comments[t].Created=d(e.Comments[t].Created);return e},s=function(e){for(var t=0;t<e.length;t++)e[t]=c(e[t]);return e},d=function(e){return e.replace(/:\d+ (\w\w)$/," $1")};return{init:function(){var i=t.getAsDictionary(),o=i.reportId;o?e.ajax("//testservices.baltimorecountymd.gov/api/citysourced/getreport/"+o).done(function(t,i,o){var d=new Date;d.setDate(-90);var u={Latitude:t.Latitude,Longitude:t.Longitude,StartDate:d.toLocaleDateString("en-US")};t=c(t),baltimoreCounty.pageSpecific.citySourcedData=t,t&&(t.IsOpen=t.IsOpen?"open":"closed","On Hold"===t.Status&&(t.IsOpen="on-hold"),t.Comments&&t.Comments.length>0&&t.Comments.sort(r));var m=e("#citysourced-viewer-template").html(),l=Handlebars.compile(m),p=l(t),f=e("#citysourced-viewer");n(u,function(i){i=s(i),f.hide(),f.html(p),a(e("#comments"),t.Comments,3),f.slideDown(300,function(){baltimoreCounty.pageSpecific.nearbyData=i,e("body").append('<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAqazsw3wPSSxOFVmij32C_LIhBSuyUNi8&libraries=places&callback=baltimoreCounty.pageSpecific.viewerGoogleMaps.initGoogle" async defer></script>')})})}).fail(function(t,i,n){e("#reportId").text(o),e(".bc-citysourced-reporter").hide(),e(".bc-citysourced-viewer-alert").slideDown(300)}):(e(".bc-citysourced-reporter").hide(),e(".bc-citysourced-viewer-alert").slideDown(300))}}}(jQuery,baltimoreCounty.utility.querystringer,baltimoreCounty.pageSpecific.viewerGoogleMaps),$(function(){baltimoreCounty.pageSpecific.citySourcedViewer.init()});