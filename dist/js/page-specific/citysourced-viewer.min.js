namespacer("baltimoreCounty.pageSpecific"),baltimoreCounty.pageSpecific.citySourcedViewer=function(e,t,i,o){"use strict";var n=function(t,i){e.ajax("//testservices.baltimorecountymd.gov/api/citysourced/getreportsbylatlng",{method:"POST",data:t}).done(function(e){i&&i(e)}).fail(function(e){})},r=function(e,t){var i=moment(e.Created),o=moment(t.Created);return i.isAfter(o)?-1:1},a=function(t,i,o){i&&i.length>o&&(t.find("li").not(function(e,t){return e<=o-1}).hide(),t.after('<p><a href="javascript:;" id="show-comments" aria-role="button">Load '+(i.length-o)+" more comments</a></p>"),e("#show-comments").on("click",function(){t.find("li").slideDown(500),e(this).hide()}))},c=function(){var i=t.getAsDictionary(),o=i.reportId;o?e.ajax("//testservices.baltimorecountymd.gov/api/citysourced/getreport/"+o).done(function(t,i,o){var c=new Date;c.setDate(-90);var s={Latitude:t.Latitude,Longitude:t.Longitude,StartDate:c.toLocaleDateString("en-US")};baltimoreCounty.pageSpecific.citySourcedData=t,t&&(t.IsOpen=t.IsOpen?"open":"closed","On Hold"===t.Status&&(t.IsOpen="on-hold"),t.Comments&&t.Comments.length>0&&t.Comments.sort(r));var u=e("#citysourced-viewer-template").html(),d=Handlebars.compile(u),l=d(t),p=e("#citysourced-viewer");n(s,function(i){p.hide(),p.html(l),a(e("#comments"),t.Comments,3),p.slideDown(300,function(){baltimoreCounty.pageSpecific.nearbyData=i,e("body").append('<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAqazsw3wPSSxOFVmij32C_LIhBSuyUNi8&libraries=places&callback=baltimoreCounty.pageSpecific.viewerGoogleMaps.initGoogle" async defer></script>')})})}).fail(function(t,i,n){e("#reportId").text(o),e(".bc-citysourced-reporter").hide(),e(".bc-citysourced-viewer-alert").slideDown(300)}):(e(".bc-citysourced-reporter").hide(),e(".bc-citysourced-viewer-alert").slideDown(300))};return{init:c}}(jQuery,baltimoreCounty.utility.querystringer,baltimoreCounty.pageSpecific.viewerGoogleMaps),$(function(){baltimoreCounty.pageSpecific.citySourcedViewer.init()});