"use strict";namespacer("baltimoreCounty.pageSpecific"),baltimoreCounty.pageSpecific.citySourcedViewer=function(e,t,i,o){var n=function(t,i){e.ajax(o.urls.api.getReportLatLng,{method:"POST",data:t}).done(function(e){i&&i(e)}).fail(function(e){console.log(e)})},a=function(e,t){var o=i(e.Created),n=i(t.Created);return o.isAfter(n)?-1:1},r=function(t,i,o){i&&i.length>o&&(t.find("li").not(function(e){return e<=o-1}).hide(),t.after('<p><a href="javascript:;" id="show-comments" aria-role="button">Load '+(i.length-o)+" more comments</a></p>"),e("#show-comments").on("click",function(){t.find("li").slideDown(500),e(this).hide()}))},c=function(e){var t=e;if(t.DateCreated&&(t.DateCreated=d(e.DateCreated)),t.DateUpdated&&(t.DateUpdated=d(e.DateUpdated)),e.Comments)for(var i=0;i<t.Comments.length;i+=1)t.Comments[i].Created=d(t.Comments[i].Created);return e},s=function(e){for(var t=e,i=0;i<e.length;i+=1)t[i]=c(e[i]);return t},d=function(e){var t=/:\d+ (\w\w)$/;return e.replace(t," $1")};return{init:function(){var i=t.getAsDictionary(),d=i.reportid;d?e.ajax(o.urls.api.getReport+"/"+d).done(function(t){var i=t,o=new Date;o.setDate(-90);var d={Latitude:t.Latitude,Longitude:t.Longitude,StartDate:o.toLocaleDateString("en-US")};i=c(t),baltimoreCounty.pageSpecific.citySourcedData=t,t&&(i.IsOpen=t.IsOpen?"open":"closed","On Hold"===t.Status&&(i.IsOpen="on-hold"),t.Comments&&t.Comments.length>0&&t.Comments.sort(a));var u=e("#citysourced-viewer-template").html(),l=Handlebars.compile(u),m=l(t),p=e("#citysourced-viewer");n(d,function(i){var o=s(i);p.hide(),p.html(m),r(e("#comments"),t.Comments,3),p.slideDown(300,function(){baltimoreCounty.pageSpecific.nearbyData=o,e("body").append('<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAqazsw3wPSSxOFVmij32C_LIhBSuyUNi8&libraries=places&callback=baltimoreCounty.pageSpecific.viewerGoogleMaps.initGoogle" async defer><\/script>')})})}).fail(function(){e("#reportId").text(d),e(".bc-citysourced-reporter").hide(),e(".bc-citysourced-viewer-alert").slideDown(300)}):(e(".bc-citysourced-reporter").hide(),e(".bc-citysourced-viewer-alert").slideDown(300))}}}(jQuery,baltimoreCounty.utility.querystringer,moment,baltimoreCounty.constants.baltCoGo),$(function(){baltimoreCounty.pageSpecific.citySourcedViewer.init()});