namespacer("baltimoreCounty.pageSpecific"),baltimoreCounty.pageSpecific.citySourcedReporter=function(e,t,a,i){"use strict";var n,r=["categories[1]","categories[2]","categories[3]","description","address","map-latitude","map-longitude","firstName","lastName","email","deviceNumber"],o=function(e){var a=t(".bc-citysourced-reporter"),i=a.find("#citysourced-reporter-form"),r=i.find("#category-selection"),o=i.find(".panel"),c=a.find(".bc-citysourced-reporter-steps li"),f={$wrapper:a,animationFactor:300,$form:i,$categories:r,$panels:o,$steps:c,$firstPanel:o.first(),$lastPanel:o.last(),$prevButton:t("#prevButton"),$nextButton:t("#nextButton"),$fileReportButton:t("#fileReportButton")};t.ajax(e).done(function(e){n=e,u(n,r,1)}),f.$nextButton.on("click",f,s),f.$prevButton.on("click",f,l),f.$fileReportButton.on("click",f,d),i.find("input, textarea").on("blur keyup",function(e){var t=e.which||e.keyCode;9!==t&&m([e.target.id])})},d=function(e){if(!m(r)){t(e.target).prop("disabled","true").val("Submitting request...");var a=e.data.$form,i=e.data.$wrapper,n=e.data.animationFactor,o=e.data.$categories.find("select").last(),d={CategoryId:o.val(),CategoryName:o.find("option[value="+o.val()+"]").text(),Details:a.find("#details").val(),Longitude:a.find("#map-longitude").val(),Latitude:a.find("#map-latitude").val(),FirstName:a.find("#firstName").val(),LastName:a.find("#lastName").val(),Email:a.find("#email").val(),DeviceNumber:a.find("#deviceNumber").val()},s={data:d,dataType:"json",method:"POST",cache:!1};t.ajax("//testservices.baltimorecountymd.gov/api/citysourced/createreport",s).done(function(e,a,r){i.fadeOut(n,function(){var a=JSON.parse(e);t("#issueId").text(a.CsResponse.ReportId),t(".bc-citysourced-reporter-alert.alert-success").fadeIn(n)})}).fail(function(e,a,r){i.fadeOut(n,function(){t(".bc-citysourced-reporter-alert.alert-warning").fadeIn(n)}),console.log(a,r)})}},s=function(e){if(m(r))return void e.data.$form.find("[aria-invalid=true]").first().focus();var a=e.data.$panels.filter(":visible"),i=a.next(".panel").first();i.is(e.data.$lastPanel)?(t(e.target).addClass("hidden"),e.data.$fileReportButton.removeClass("hidden"),e.data.$fileReportButton.attr("aria-hidden",!1)):t(e.target).removeClass("hidden"),t(e.target).attr("aria-hidden",t(e.target).hasClass("hidden")),i.length&&a.fadeOut(e.data.animationFactor,function(){if(i.fadeIn(e.data.animationFactor),a.attr("aria-hidden","true"),i.attr("aria-hidden","false"),e.data.$steps.eq(i.index()).toggleClass("highlight"),e.data.$prevButton.removeClass("hidden"),i.find("#map").length&&google.maps){var t=map.getCenter();google.maps.event.trigger(map,"resize"),map.setCenter(t)}}),t("html, body").animate({scrollTop:t("#mainContent").offset().top},e.data.animationFactor,function(){c(e.data.$panels)})},l=function(e){if(m(r))return void e.data.$form.find("[aria-invalid=true]").first().focus();var a=e.data.$panels.filter(":visible"),i=a.prev(".panel").first();e.data.$fileReportButton.addClass("hidden"),i.is(e.data.$firstPanel)?t(e.target).addClass("hidden"):t(e.target).removeClass("hidden"),t(e.target).attr("aria-hidden",t(e.target).hasClass("hidden")),i.length&&(e.data.$steps.eq(i.index()+1).toggleClass("highlight"),a.fadeOut(e.data.animationFactor,function(){i.fadeIn(e.data.animationFactor),e.data.$nextButton.removeClass("hidden")})),t("html, body").animate({scrollTop:t("#mainContent").offset().top},e.data.animationFactor,function(){c(e.data.$panels)})},c=function(e){e.filter(":visible").find("input, select, textarea").filter(":visible").first().focus()},u=function(e,a,i){var n=t("<select>",{id:"categories["+i+"]","aria-labelledby":"categories-label","aria-required":!0});n.insertBefore(a.find(".error-message"));var r=t("<option>",{value:-1,text:"--- Select a request category ---",selected:"selected"});n.append(r),n.on("blur change",function(e){m([e.target.id])}),t.each(e,function(e,a){var i=t("<option>",{value:a.id,text:a.name});n.append(i)}),n.on("change",{fragment:e},f)},f=function(e){var i,n=t(e.target),r=n.val(),o=n.find("option[value="+r+"]").text(),d=t("#report-category");if(n.nextAll("select").remove(),"-1"===r)return void d.val("");i=n.siblings("select").length+1;var s=a.getSubtree(e.data.fragment,"name","types",o);s?u(s,n.parent(),i+1):d.val(r)},p=function(e){var a=e.attr("id");if(e.is(":visible")){if("address"===a&&!t("#map-latitude").val()&&!t("#map-longitude").val())return e.parent().addClass("error"),a;if(!e.val()||"-1"===e.val())return e.parent().addClass("error"),e.attr("aria-invalid","true"),a;e.parent().removeClass("error"),e.attr("aria-invalid","false")}},m=function(e){var a,i,n=[];return e.length?t.each(e,function(e,r){a=t(document.getElementById(r.id?r.id:r)),i=p(a),i&&n.push(i)}):(a=t(document.getElementById(e.id)),i=p(a),i&&n.push(i)),n.length};return{init:o}}(window,jQuery,baltimoreCounty.utility.jsonTools),$(function(){baltimoreCounty.pageSpecific.citySourcedReporter.init("/sebin/q/k/categories.json")});