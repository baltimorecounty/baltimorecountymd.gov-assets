namespacer("baltimoreCounty.pageSpecific"),baltimoreCounty.pageSpecific.citySourcedReporter=function(e,t,a,n,i){"use strict";var r=["categories[1]","categories[2]","categories[3]","description","address","map-latitude","map-longitude","firstName","lastName","email","deviceNumber"],o=function(e){var i=t(".bc-citysourced-reporter"),r=i.find("#citysourced-reporter-form"),o=r.find("#category-selection"),s=r.find("#other-pet-type-selection"),u=r.find("#primary-breed-selection"),m=(r.find("#secondary-breed-selection"),r.find("#primary-color-selection")),v=(r.find("#secondary-color-selection"),r.find(".panel")),y=i.find(".bc-citysourced-reporter-steps li"),$=(i.find("#deviceNumber"),n.getAsDictionary()),C={$wrapper:i,animationFactor:300,$form:r,$categories:o,$panels:v,$steps:y,$firstPanel:v.first(),$lastPanel:v.last(),$prevButton:t("#prevButton"),$nextButton:t("#nextButton"),$fileReportButton:t("#fileReportButton")};d(e,function(e){if($.categoryId)var t=a.getSubtreePath(e,"id","types",$.categoryId);t?h(o,e,t):g(e,o,1)}),d("animal-breeds.json",function(e){p("breeds",e[0].breeds,u,1,"Select a primary breed")}),d("animal-colors.json",function(e){p("colors",e.colors,m,1,"Select a primary color")}),d("animal-types.json",function(e){p("animals",e,s,1,"Select an animal type")}),C.$nextButton.on("click",C,c),C.$prevButton.on("click",C,f),C.$fileReportButton.on("click",C,l),r.find("input, textarea").on("blur keyup",function(e){9!==(e.which||e.keyCode)&&b([e.target.id],e)})},d=function(e,a){t.ajax(e).done(function(e){a(e)}).fail(function(e){console.log(e)})},s=function(e){for(var t=e.find("select"),a=[],n=0;n<t.length;n++){var i=t.eq(n).val(),r=t.eq(n).find("option[value="+i+"]").text();a.push({name:r,id:i})}return a},l=function(e){if(!b(r,e)){t(e.target).prop("disabled","true").val("Submitting request...");var a=e.data.$form,n=s(e.data.$categories),i=e.data.$wrapper,o=e.data.animationFactor,d=(e.data.$categories.find("select").first(),e.data.$categories.find("select").last(),t(".bc-citysourced-reporter-instructions")),l={CategoryNamesAndIds:n,Description:a.find("#description").val(),Longitude:a.find("#map-longitude").val(),Latitude:a.find("#map-latitude").val(),FirstName:a.find("#firstName").val(),LastName:a.find("#lastName").val(),Email:a.find("#email").val(),DeviceNumber:a.find("#deviceNumber").val()},c={data:l,dataType:"json",method:"POST",cache:!1};t.ajax("//testservices.baltimorecountymd.gov/api/citysourced/createreport",c).done(function(e,a,n){i.fadeOut(o,function(){var a=JSON.parse(e);t("#issueId").text(a.CsResponse.ReportId),d.fadeOut(o,function(){t(".bc-citysourced-reporter-alert.alert-success").fadeIn(o)})})}).fail(function(e,a,n){i.fadeOut(o,function(){d.fadeOut(o,function(){t(".bc-citysourced-reporter-alert.alert-warning").fadeIn(o)})}),console.log(a,n)})}},c=function(e){if(b(r,e))return void e.data.$form.find("[aria-invalid=true]").first().focus();var a=e.data.$panels.filter(":visible"),n=a.next(".panel").first();n.is(e.data.$lastPanel)?(t(e.target).addClass("hidden"),e.data.$fileReportButton.removeClass("hidden"),e.data.$fileReportButton.attr("aria-hidden",!1)):t(e.target).removeClass("hidden"),t(e.target).attr("aria-hidden",t(e.target).hasClass("hidden")),n.length&&a.fadeOut(e.data.animationFactor,function(){if(n.fadeIn(e.data.animationFactor),a.attr("aria-hidden","true"),n.attr("aria-hidden","false"),e.data.$steps.eq(n.index()).toggleClass("highlight"),e.data.$prevButton.removeClass("hidden"),n.find("#map").length&&google.maps){var t=map.getCenter();google.maps.event.trigger(map,"resize"),map.setCenter(t)}}),t("html, body").animate({scrollTop:t("#mainContent").offset().top},e.data.animationFactor,function(){u(e.data.$panels)})},f=function(e){if(b(r,e))return void e.data.$form.find("[aria-invalid=true]").first().focus();var a=e.data.$panels.filter(":visible"),n=a.prev(".panel").first();e.data.$fileReportButton.addClass("hidden"),n.is(e.data.$firstPanel)?t(e.target).addClass("hidden"):t(e.target).removeClass("hidden"),t(e.target).attr("aria-hidden",t(e.target).hasClass("hidden")),n.length&&(e.data.$steps.eq(n.index()+1).toggleClass("highlight"),a.fadeOut(e.data.animationFactor,function(){n.fadeIn(e.data.animationFactor),e.data.$nextButton.removeClass("hidden")})),t("html, body").animate({scrollTop:t("#mainContent").offset().top},e.data.animationFactor,function(){u(e.data.$panels)})},u=function(e){e.filter(":visible").find("input, select, textarea").filter(":visible").first().focus()},p=function(e,a,n,i,r,o){var d=t("<select>",{id:e+"["+i+"]","aria-labelledby":n.find("label").attr("id"),"aria-required":!0}),s=n.find(".error-message");s.length?d.insertBefore(s):n.append(d);var l=t("<option>",{value:-1,text:"--- "+r+" ---",selected:!o&&"selected"});return d.append(l),t.each(a,function(e,a){var n=t("<option>",{value:a.id,text:a.name,selected:a.id===o});d.append(n)}),d},g=function(e,t,a,n){var i=p("categories",e,t,a,"Select a request category",n);i.on("blur change",function(e){b([e.target.id])}),i.on("change",{fragment:e},m)},m=function(e){var n,i=t(e.currentTarget),r=i.val(),o=i.find("option[value="+r+"]").text();t("#category-selection");if($trackingField=t("#report-category"),"pets"===o.toLowerCase()&&(t("#pet-type").fadeIn(250),t("#pet-type select").on("change",v)),i.nextAll("select").remove(),"-1"===r)return void $trackingField.val("");n=i.siblings("select").length+1;var d=a.getSubtree(e.data.fragment,"name","types",o);d?g(d,i.parent(),n+1):$trackingField.val(r)},v=function(e){var a=t(e.currentTarget),n=a.val(),i=a.find("option[value="+n+"]").text();switch(t("#breeds-and-colors, #other-pet-type").fadeOut(250),i.toLowerCase()){case"cat":case"dog":t("#breeds-and-colors").fadeIn(250);break;case"other":t("#other-pet-type").fadeIn(250)}},h=function(e,a,n){for(var i=t.map(n,function(e){return e}),r=0;r<i.length;r++){g(a,e,r+1,i[r]);for(var o=0;o<a.length;o++)if(a[o].id===i[r]){a=a[o].types;break}}t("#report-category").val(i[i.length-1])},y=function(e,a){var n=e.attr("id");if(e.is(":visible")){if(!e.val()||"-1"===e.val())return e.parent().addClass("error"),e.attr("aria-invalid","true"),n;if(e.parent().removeClass("error"),e.attr("aria-invalid","false"),"address"===n&&!t("#map-latitude").val()&&!t("#map-longitude").val())return e.parent().addClass("error"),n;if("deviceNumber"==n&&"blur"===a.type){var i=e.val(),r=i.match(/\d+/g);if(10!=(r?r.join(""):"").length)return e.parent().addClass("error"),n}}},b=function(e,a){var n,i,r=[];return e.length?t.each(e,function(e,o){n=t(document.getElementById(o.id?o.id:o)),(i=y(n,a))&&r.push(i)}):(n=t(document.getElementById(e.id)),(i=y(n,a))&&r.push(i)),r.length};return{init:o}}(window,jQuery,baltimoreCounty.utility.jsonTools,baltimoreCounty.utility.querystringer),$(function(){baltimoreCounty.pageSpecific.citySourcedReporter.init("categories.json")});