namespacer("baltimoreCounty.pageSpecific"),baltimoreCounty.pageSpecific.citySourcedReporter=function(e,t,a,i,r){"use strict";var n=["categories[1]","categories[2]","categories[3]","description","address","map-latitude","map-longitude","firstName","lastName","email","deviceNumber"],o=function(e){var a=t(".bc-citysourced-reporter"),r=a.find("#citysourced-reporter-form"),n=r.find("#category-selection"),o=r.find(".panel"),c=a.find(".bc-citysourced-reporter-steps li"),f=(a.find("#deviceNumber"),i.getAsDictionary(),{$wrapper:a,animationFactor:300,$form:r,$categories:n,$panels:o,$steps:c,$firstPanel:o.first(),$lastPanel:o.last(),$prevButton:t("#prevButton"),$nextButton:t("#nextButton"),$fileReportButton:t("#fileReportButton")});t.ajax(e).done(function(e){u(e,n,1)}),f.$nextButton.on("click",f,l),f.$prevButton.on("click",f,s),f.$fileReportButton.on("click",f,d),r.find("input, textarea").on("blur keyup",function(e){var t=e.which||e.keyCode;9!==t&&m([e.target.id])})},d=function(e){if(!m(n)){t(e.target).prop("disabled","true").val("Submitting request...");var a=e.data.$form,i=e.data.$wrapper,r=e.data.animationFactor,o=e.data.$categories.find("select").last(),d={CategoryId:o.val(),CategoryName:o.find("option[value="+o.val()+"]").text(),Details:a.find("#details").val(),Longitude:a.find("#map-longitude").val(),Latitude:a.find("#map-latitude").val(),FirstName:a.find("#firstName").val(),LastName:a.find("#lastName").val(),Email:a.find("#email").val(),DeviceNumber:a.find("#deviceNumber").val()},l={data:d,dataType:"json",method:"POST",cache:!1};t.ajax("//testservices.baltimorecountymd.gov/api/citysourced/createreport",l).done(function(e,a,n){i.fadeOut(r,function(){var a=JSON.parse(e);t("#issueId").text(a.CsResponse.ReportId),t(".bc-citysourced-reporter-alert.alert-success").fadeIn(r)})}).fail(function(e,a,n){i.fadeOut(r,function(){t(".bc-citysourced-reporter-alert.alert-warning").fadeIn(r)}),console.log(a,n)})}},l=function(e){if(m(n))return void e.data.$form.find("[aria-invalid=true]").first().focus();var a=e.data.$panels.filter(":visible"),i=a.next(".panel").first();i.is(e.data.$lastPanel)?(t(e.target).addClass("hidden"),e.data.$fileReportButton.removeClass("hidden"),e.data.$fileReportButton.attr("aria-hidden",!1)):t(e.target).removeClass("hidden"),t(e.target).attr("aria-hidden",t(e.target).hasClass("hidden")),i.length&&a.fadeOut(e.data.animationFactor,function(){if(i.fadeIn(e.data.animationFactor),a.attr("aria-hidden","true"),i.attr("aria-hidden","false"),e.data.$steps.eq(i.index()).toggleClass("highlight"),e.data.$prevButton.removeClass("hidden"),i.find("#map").length&&google.maps){var t=map.getCenter();google.maps.event.trigger(map,"resize"),map.setCenter(t)}}),t("html, body").animate({scrollTop:t("#mainContent").offset().top},e.data.animationFactor,function(){c(e.data.$panels)})},s=function(e){if(m(n))return void e.data.$form.find("[aria-invalid=true]").first().focus();var a=e.data.$panels.filter(":visible"),i=a.prev(".panel").first();e.data.$fileReportButton.addClass("hidden"),i.is(e.data.$firstPanel)?t(e.target).addClass("hidden"):t(e.target).removeClass("hidden"),t(e.target).attr("aria-hidden",t(e.target).hasClass("hidden")),i.length&&(e.data.$steps.eq(i.index()+1).toggleClass("highlight"),a.fadeOut(e.data.animationFactor,function(){i.fadeIn(e.data.animationFactor),e.data.$nextButton.removeClass("hidden")})),t("html, body").animate({scrollTop:t("#mainContent").offset().top},e.data.animationFactor,function(){c(e.data.$panels)})},c=function(e){e.filter(":visible").find("input, select, textarea").filter(":visible").first().focus()},u=function(e,a,i){var r=t("<select>",{id:"categories["+i+"]","aria-labelledby":"categories-label","aria-required":!0});r.insertBefore(a.find(".error-message"));var n=t("<option>",{value:-1,text:"--- Select a request category ---",selected:"selected"});r.append(n),r.on("blur change",function(e){m([e.target.id])}),t.each(e,function(e,a){var i=t("<option>",{value:a.id,text:a.name});r.append(i)}),r.on("change",{fragment:e},f)},f=function(e){var i,r=t(e.target),n=r.val(),o=r.find("option[value="+n+"]").text(),d=t("#report-category");if(r.nextAll("select").remove(),"-1"===n)return void d.val("");i=r.siblings("select").length+1;var l=a.getSubtree(e.data.fragment,"name","types",o);l?u(l,r.parent(),i+1):d.val(n)},p=function(e){var a=e.attr("id");if(e.is(":visible")){if(!e.val()||"-1"===e.val())return e.parent().addClass("error"),e.attr("aria-invalid","true"),a;if(e.parent().removeClass("error"),e.attr("aria-invalid","false"),"address"===a&&!t("#map-latitude").val()&&!t("#map-longitude").val())return e.parent().addClass("error"),a;if("deviceNumber"==a){var i=e.val(),r=i.match(/\d+/g),n=r?r.join(""):"";if(10!=n.length)return e.parent().addClass("error"),a}}},m=function(e){var a,i,r=[];return e.length?t.each(e,function(e,n){a=t(document.getElementById(n.id?n.id:n)),i=p(a),i&&r.push(i)}):(a=t(document.getElementById(e.id)),i=p(a),i&&r.push(i)),r.length};return{init:o}}(window,jQuery,baltimoreCounty.utility.jsonTools,baltimoreCounty.utility.querystringer),$(function(){baltimoreCounty.pageSpecific.citySourcedReporter.init("/sebin/q/k/categories.json")});