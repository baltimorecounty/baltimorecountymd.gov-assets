!function(){"use strict";angular.module("baltcogoApp",[])}(),function(e,t){"use strict";var o={urls:{geocodeServer:t.urls.api.geocodeServer,suggestions:t.urls.api.suggestions,createReport:t.urls.api.createReport,getReport:t.urls.api.getReport,getReportLatLng:t.urls.api.getReportLatLng,json:{animalBreeds:t.urls.json.animalBreeds,animalColors:t.urls.json.animalColors,animalTypes:t.urls.json.animalTypes,categories:t.urls.json.categories,petTypes:t.urls.json.petTypes}},locations:{courtHouse:{latitude:t.locations.courtHouse.latitude,longitude:t.locations.courtHouse.longitude}}};e.constant("CONSTANTS",o)}(angular.module("baltcogoApp"),baltimoreCounty.constants.baltCoGo),function(e){function t(e,t){function o(e){return e.replace(", USA","")}var a,n=function(e,t){return new google.maps.Map(document.getElementById(e),t)},i=function(e,t,o){a&&a.setMap(null),a=new google.maps.Marker({position:{lat:t,lng:o},map:e,icon:"/sebin/n/f/icon-marker-my-report.png",draggable:!1,animation:google.maps.Animation.DROP})},r=function(o,a,n,i){e.get(t.urls.geocodeServer+"/reverseGeocode?location=%7B%22x%22%3A"+a+"%2C+%22y%22%3A"+o+"%7D&f=pjson").then(n,i)},s=function(o,a){var n=encodeURIComponent(o);e.get(t.urls.suggestions+n).then(function(e){var t=[];angular.forEach(e.data,function(e){t.push({address:e.StreetAddress+", "+e.City+", "+e.Zip,longitude:e.Longitude,latitude:e.Latitude})}),a(t)},function(e){console.log(e)})};return{createMap:n,createMarker:i,pan:function(e,t,o){e.panTo({lat:t,lng:o})},removeCountry:o,reverseGeocode:r,suggestAddresses:s}}e.factory("mapServiceComposite",["$http","CONSTANTS",t])}(angular.module("baltcogoApp")),function(e){"use strict";function t(e,t){function o(o,a,n){var i={headers:{"Content-Type":"application/json"}};e.post(t.urls.createReport,o,i).then(function(e){a(e.data)},function(e){n(e)})}function a(o,a,n){e.get(t.urls.getReport+o).then(function(e){a(e.data)},function(e){n(e)})}function n(o,a,n){var i={headers:{"Content-Type":"application/json"}};e.post(t.urls.getReportLatLng,o,i).then(function(e){a(e.data)},function(e){n(e)})}return{post:o,getById:a,getNearby:n}}e.factory("reportService",["$http","CONSTANTS",t])}(angular.module("baltcogoApp")),function(e,t){"use strict";function o(e,o,a,n,i,r){function s(e){angular.forEach(T.categoryData,function(t){t.id===e?(T.category=t,T.loadSubCategories()):t.types&&angular.forEach(t.types,function(o){o.id===e&&(T.category=t,T.loadSubCategories(),T.subCategory=o)})})}function u(){T.subCategory="",T.petType="",T.otherPetType="",T.petSex="",T.primaryColor="",T.primaryBreed="",T.animalDescription="",T.streetAddress="",T.city="",T.zipCode="",T.descriptionOfAnimalId=0,T.descriptionOfLocationId=0,T.otherDescriptionId=0}function l(e,t){var o="";return angular.forEach(e,function(e){return e.id===t&&(o=e.name,!0)}),o}function d(){var e=S.getCenter();google.maps.event.trigger(S,"resize"),S.setCenter(e)}function c(){var e=angular.element("#citysourced-reporter-form .panel:visible [required]"),t=e.length,a=o.citySourcedReporterForm.$$controls;return angular.forEach(a,function(e){e.$$element.closest(".panel").is(":visible")&&(e.$pristine&&e.$setDirty(),e.$untouched&&e.$setTouched(),e.$$element.is("#map-latitude")&&0===T.latitude&&e.$setValidity("required",!1),e.$$element.is("#map-longitude")&&0===T.longitude&&e.$setValidity("required",!1),e.$$element.is("#address")&&(0!==T.latitude&&0!==T.longitude||e.$setValidity("required",!1)))}),t===e.filter(".ng-valid").length}function p(e){var t=e.which||e.keyCode;if(40===t)return e.preventDefault(),void angular.element(".autocomplete-results button").first().focus();if(13!==t)if(46!==t&&8!==t||(T.longitude=0,T.latitude=0),T.address&&T.address.trim().length>3){var a=T.address.trim().split(","),i=a[0];n.suggestAddresses(i,function(e){T.autocompleteResults=e})}else T.autocompleteResults=[];else if(T.autocompleteResults.length>0){var r=angular.element(".autocomplete-results button").first();r.trigger("click"),o.$apply()}}function g(e){var t=e.which||e.keyCode,a=angular.element(e.target);a.is(".autocomplete-results button")&&(27===t&&angular.element(".autocomplete-results").is(":visible")&&(T.autocompleteResults=[],o.$apply()),e.preventDefault(),13!==t&&32!==t||a.trigger("click"),40===t&&a.parent().next().find("button").focus(),38===t&&a.parent().prev().find("button").focus())}function m(e){T.animalTypeData=e.data}function f(e){T.animalBreedData=e.data}function y(e){T.categoryData=e.data,A&&s(A)}function C(e){T.animalColorData=e.data}function v(e){console.log(e)}function h(e){var t=angular.element("#map").closest("cs-form-control"),a=o.citySourcedReporterForm.address;T.autocompleteResults=[],T.latitude=e.latLng.lat(),T.longitude=e.latLng.lng(),n.reverseGeocode(T.latitude,T.longitude,function(e){t.removeClass("error"),n.createMarker(S,T.latitude,T.longitude),T.address=e.data.address.Street.toLowerCase()+", "+e.data.address.City.toLowerCase()+", "+e.data.address.State.toUpperCase()},function(e){t.addClass("error"),a.$setDirty(),T.address=""})}function D(e){T.petTypeData=e.data}function b(e){13===(e.which||e.keyCode)&&e.preventDefault()}var S,T=this,A=1*t.getAsDictionary().categoryid;T.isAnimal=!1,T.page=1,T.isDone=!1,T.isSuccess=!1,T.issueId="",T.isLoading=!1,T.latitude=0,T.longitude=0,T.category=0;var L={center:{lat:r.locations.courtHouse.latitude,lng:r.locations.courtHouse.longitude},scrollwheel:!1,zoom:14,mapTypeId:"roadmap",mapTypeControl:!1,streetViewControl:!1,gestureHandling:"greedy"};S=n.createMap("map",L),e.get(r.urls.json.animalBreeds).then(f,v),e.get(r.urls.json.animalColors).then(C,v),e.get(r.urls.json.animalTypes).then(m,v),e.get(r.urls.json.categories).then(y,v),e.get(r.urls.json.petTypes).then(D,v),google.maps.event.addListener(S,"click",h),angular.element(document).on("keyup keypress","#citysourced-reporter-form",b),angular.element(document).on("keyup","#address",p),angular.element(window).on("keydown",g),T.fileReportClick=function(){if(c()){var e=[{name:"Category",id:T.category.id,value:T.category.name},{name:"SubCategory",id:T.subCategory.id,value:T.subCategory.name},{name:"Description",id:T.descriptionId,value:T.description},{name:"Latitude",value:T.latitude},{name:"Longitude",value:T.longitude},{name:"FirstName",value:T.firstName},{name:"LastName",value:T.lastName},{name:"Email",value:T.email},{name:"DeviceNumber",value:T.deviceNumber}];T.locationDescription&&e.push({name:"Description Of Location",id:T.descriptionOfLocationId,value:T.locationDescription}),T.otherDescription&&e.push({name:"Other Description",id:T.otherDescriptionId,value:T.otherDescription}),T.petType&&e.push({name:"Pet Type",id:T.petType.id,value:l(T.petTypeData,T.petType.id)}),T.petSex&&e.push({name:"Sex",id:T.petSex.id,value:l(T.sex,T.petSex.id)}),T.otherPetType&&e.push({name:"Other Pet Type",id:T.otherPetType,value:l(T.animalTypeData,T.otherPetType)}),T.primaryBreed&&e.push({name:"Primary Breed",id:T.primaryBreed,value:l(T.breeds,T.primaryBreed)}),T.primaryColor&&e.push({name:"Primary Color",id:T.primaryColor,value:l(T.animalColorData,T.primaryColor)}),T.animalDescription&&e.push({name:"Description Of Animal",id:1*angular.element("#animalDescription").attr("data-cs-id"),value:T.animalDescription}),T.streetAddress&&e.push({name:"Complainant Address",id:T.streetAddressId,value:T.streetAddress}),T.city&&e.push({name:"Complainant City",id:T.cityId,value:T.city}),T.zipCode&&e.push({name:"Complainant Zip Code",id:T.zipCodeId,value:T.zipCode}),T.isLoading=!0,T.isDone=!0,i.post(e,function(e){T.isLoading=!1,T.isSuccess=!0,T.issueId=JSON.parse(e).CsResponse.ReportId},function(e){T.isLoading=!1,console.log(e)})}},T.loadSubCategories=function(){if(!T.category)return void(T.subCategories=[]);angular.forEach(T.categoryData,function(e){u(),e.id===T.category.id&&(T.subCategories=e.types,e.states?(T.states=e.states,T.state=e.states[0]):T.states=[],e.fields&&(T.streetAddressId=e.fields.streetAddress,T.cityId=e.fields.city,T.zipCodeId=e.fields.zipCode),T.isAnimal="pets and animals"===e.name.toLowerCase(),a(function(){e.descriptionOfAnimal&&(T.descriptionOfAnimalId=e.descriptionOfAnimal),e.descriptionOfLocation&&(T.descriptionOfLocationId=e.descriptionOfLocation),e.otherDescription&&(T.otherDescriptionId=e.otherDescription)},0),T.descriptionId=e.description)})},T.nextClick=function(){c()?(T.page+=1,2===T.page&&"Website"===T.category.name&&(T.latitude=r.locations.courtHouse.latitude,T.longitude=r.locations.courtHouse.longitude,T.page=3),2===T.page&&a(d,500)):o.citySourcedReporterForm.$setSubmitted()},T.prevClick=function(){T.page-=1,2===T.page&&"Website"===T.category.name&&(T.latitude=r.locations.courtHouse.latitude,T.longitude=r.locations.courtHouse.longitude,T.page=1),2===T.page&&a(d,500)},T.setLocation=function(e,t,o){T.address=e.autocompleteResult.address,T.longitude=t,T.latitude=o,T.autocompleteResults=[],n.pan(S,o,t),n.createMarker(S,o,t)},T.trackBreed=function(){angular.forEach(T.animalBreedData,function(e){e.id===T.petType.id&&(T.breeds=e.breeds?e.breeds:[],T.sex=e.sex)})}}e.controller("BaltCoGoReporterCtrl",["$http","$scope","$timeout","mapServiceComposite","reportService","CONSTANTS",o])}(angular.module("baltcogoApp"),baltimoreCounty.utility.querystringer);