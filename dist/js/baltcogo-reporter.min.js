!function(){"use strict";angular.module("baltcogoApp",[])}(),function(e){"use strict";function t(e){function t(e){return e.replace(", USA","")}var o,n="http://bcgis.baltimorecountymd.gov/arcgis/rest/services/Geocoders/AddressPoint_NAD83/GeocodeServer",a=function(e,t){return new google.maps.places.Autocomplete(document.getElementById(e),t)},r=function(e,t){return new google.maps.Map(document.getElementById(e),t)},i=function(e,t,n){o&&o.setMap(null),o=new google.maps.Marker({position:{lat:t,lng:n},map:e,icon:"/sebin/n/f/icon-marker-my-report.png",draggable:!1,animation:google.maps.Animation.DROP})},s=function(e,t,o,a){require(["esri/tasks/Locator","esri/geometry/Point"],function(r,i){var s=new i(t,e),c={countryCode:"US",outSpatialReference:4269,url:n},u=new r(c);u.locationToAddress(s).then(o,a)})},c=function(e,t){require(["esri/tasks/Locator","esri/geometry/Point"],function(o,a){var r={countryCode:"US",outSpatialReference:4269,url:n},i={location:new a(-76.60652470000002,39.4003288),text:e},s={responseType:"json"};new o(r).suggestLocations(i,s).then(function(e){var o=[];angular.forEach(e,function(e){o.push(e.text.toLowerCase())}),t(o)},function(e){console.log("err",e)})})},u=function(e,t){return e.score<t.score?1:e.score>t.score?-1:0};return{addressLookup:function(e,t,o){require(["esri/tasks/Locator"],function(a){var r={countryCode:"US",outSpatialReference:4269,url:n},i={address:{"Single Line Input":e},f:"json"},s={responseType:"json"};new a(r).addressToLocations(i,s).then(function(e){if(e.length){var n=e.sort(u);t(n[0])}else o("No location was found for this address.")},o)})},createAutoComplete:a,createMap:r,createMarker:i,pan:function(e,t,o){e.panTo({lat:t,lng:o})},removeCountry:t,reverseGeocode:s,suggestAddresses:c}}e.factory("mapServiceComposite",["$http",t])}(angular.module("baltcogoApp")),function(e){"use strict";function t(e){var t,o,n="http://bcgis.baltimorecountymd.gov/arcgis/rest/services/Geocoders/AddressPoint_NAD83/GeocodeServer",a=function(e,n){require(["esri/Map","esri/views/MapView","esri/symbols/PictureMarkerSymbol","esri/Graphic","esri/geometry/Point","dojo/domReady!"],function(a,r,i,s,c){t=new i({url:"http://dev.baltimorecountymd.gov/sebin/n/f/icon-marker-my-report.png",height:60,width:35}),o=new i({url:"http://dev.baltimorecountymd.gov/sebin/n/p/icon-marker-other.png",height:55,width:35});var u={basemap:"topo-vector"},d=new a(u),l={container:e,map:d,zoom:13,center:[-76.6063945,39.4001857]},p=new r(l);n(p,c,s)})},r=function(e,t){require(["esri/tasks/Locator","esri/geometry/Point"],function(o,a){var r={countryCode:"US",outSpatialReference:4269,url:n},i={location:new a(-76.6063945,39.4001857),text:e},s={responseType:"json"};new o(r).suggestLocations(i,s).then(function(e){var o=[];angular.forEach(e,function(e){o.push(e.text)}),t(o)},function(e){console.log("err",e)})})},i=function(e,t){require(["esri/tasks/Locator"],function(o){var a={countryCode:"US",outSpatialReference:4269,url:n},r={address:{"Single Line Input":e},f:"json"},i={responseType:"json"};new o(a).addressToLocations(r,i).then(function(e){if(e.length){var o=e.sort(c);t(o[0])}},function(e){console.log("err",e)})})},s=function(e,t,o,a){require(["esri/tasks/Locator","esri/geometry/Point"],function(r,i){var s=new i(e,t),c={countryCode:"US",outSpatialReference:4269,url:n},u=new r(c);u.locationToAddress(s).then(o,a)})},c=function(e,t){return e.score<t.score?1:e.score>t.score?-1:0};return{createMap:a,dropMarker:function(e,n,a,r,i){require(["esri/Graphic","esri/geometry/Point","dojo/domReady!"],function(s,c){var u=new c(n,a),d=new s(u,i?o:t);e.goTo(u,{animate:!0,duration:250}),r&&e.graphics.removeAll(),e.graphics.add(d)})},lookupAddress:i,reverseGeocode:s,suggestAddresses:r}}e.factory("mapService",["$http",t])}(angular.module("baltcogoApp")),function(e){"use strict";function t(e){function t(t,o,n){var a={headers:{"Content-Type":"application/json"}};e.post("https://testservices.baltimorecountymd.gov/api/baltcogo/createreport",t,a).then(function(e){o(e.data)},function(e){n(e)})}function o(t,o,n){e.get("//testservices.baltimorecountymd.gov/api/citysourced/getreport/"+t).then(function(e){o(e.data)},function(e){n(e)})}function n(t,o,n){var a={headers:{"Content-Type":"application/json"}};e.post("//ba224964:1000/api/citysourced/getreportsbylatlng",t,a).then(function(e){o(e.data)},function(e){n(e)})}return{post:t,getById:o,getNearby:n}}e.factory("reportService",["$http",t])}(angular.module("baltcogoApp")),function(e,t){"use strict";function o(e,o,n,a,r){function i(e){angular.forEach(D.categoryData,function(t){t.id===e?(D.category=t,D.loadSubCategories(t.id)):t.types&&angular.forEach(t.types,function(o){o.id===e&&(D.category=t,D.loadSubCategories(t.id),D.subCategory=o)})})}function s(){D.subCategory="",D.petType="",D.otherPetType="",D.petSex="",D.primaryColor="",D.primaryBreed="",D.animalDescription=""}function c(e){a.addressLookup(e,function(e){D.latitude=e.location.y,D.longitude=e.location.x,a.pan(S,D.latitude,D.longitude),a.createMarker(S,D.latitude,D.longitude)},function(e){y()})}function u(e,t){var o="";return angular.forEach(e,function(e){if(e.id===t)return o=e.name,!0}),o}function d(){var e=angular.element("#citysourced-reporter-form .panel:visible [required]"),t=e.length,n=e.filter(".ng-valid").length,a=o.citySourcedReporterForm.$$controls;return angular.forEach(a,function(e,t,o){e.$$element.closest(".panel").is(":visible")&&(e.$pristine&&e.$setDirty(),e.$untouched&&e.$setTouched(),e.$$element.is("#address")&&(angular.element("#map-latitude").is(".ng-invalid")||angular.element("#map-longitude").is(".ng-invalid"))&&e.$setValidity("required",!1))}),t===n}function l(e){if(13===(e.which||e.keyCode)){if(D.autocompleteResults.length>0){var t=D.autocompleteResults[0];D.address=t,D.autocompleteResults=[],o.$apply(),c(t)}}else D.address&&D.address.trim().length>3&&a.suggestAddresses(D.address,function(e){D.autocompleteResults=e,o.$apply()})}function p(e){D.animalTypeData=e.data}function m(e){D.animalBreedData=e.data}function g(e){D.categoryData=e.data,w&&i(w)}function f(e){D.animalColorData=e.data}function y(){angular.element("#map").closest("cs-form-control").addClass("error"),o.citySourcedReporterForm.address.$setDirty(),D.address="",o.$apply()}function v(e){console.log(e)}function h(e){var t=angular.element("#map").closest("cs-form-control"),n=o.citySourcedReporterForm.address;D.autocompleteResults=[],D.latitude=e.latLng.lat(),D.longitude=e.latLng.lng(),a.reverseGeocode(D.latitude,D.longitude,function(e){t.removeClass("error"),a.createMarker(S,D.latitude,D.longitude),D.address=e.address.Street.toLowerCase()+", "+e.address.City.toLowerCase()+", "+e.address.State.toUpperCase(),o.$apply()},function(e){t.addClass("error"),n.$setDirty(),D.address="",o.$apply()})}function C(e){D.petTypeData=e.data}function b(e){13===(e.which||e.keyCode)&&e.preventDefault()}var S,D=this,w=1*t.getAsDictionary().categoryid;e.get("/sebin/y/z/animal-breeds.json").then(m,v),e.get("/sebin/u/t/animal-colors.json").then(f,v),e.get("/sebin/a/d/animal-types.json").then(p,v),e.get("/sebin/q/l/categories.json").then(g,v),e.get("/sebin/m/z/pet-types.json").then(C,v),D.isAnimal=!1,D.page=1,D.isDone=!1,D.isSuccess=!1,D.issueId="",D.isLoading=!1;var L={center:{lat:39.4003288,lng:-76.60652470000002},scrollwheel:!1,zoom:14,mapTypeId:"roadmap",mapTypeControl:!1,streetViewControl:!1};S=a.createMap("map",L),google.maps.event.addListener(S,"click",h),angular.element("#citysourced-reporter-form").on("keyup keypress",b),angular.element("#address").on("keyup",l),D.fileReportClick=function(){if(d()){var e=[{name:"Category",id:D.category,value:u(D.categoryData,D.category)},{name:"SubCategory",id:D.subCategory,value:u(D.subCategories,D.subCategory)},{name:"Description",id:1*angular.element("#description").attr("data-cs-id"),value:D.description},{name:"Latitude",value:D.latitude},{name:"Longitude",value:D.longitude},{name:"FirstName",value:D.firstName},{name:"LastName",value:D.lastName},{name:"Email",value:D.email},{name:"DeviceNumber",value:D.deviceNumber}];if(D.locationDescription&&e.push({name:"Description Of Location",id:1*angular.element("#locationDescription").attr("data-cs-id"),value:D.locationDescription}),D.petType&&e.push({name:"Pet Type",id:D.petType.id,value:u(D.petTypeData,D.petType.id)}),D.petSex&&e.push({name:"Sex",id:D.petSex.id,value:u(D.sex,D.petSex.id)}),D.otherPetType&&e.push({name:"Other Pet Type",id:D.otherPetType,value:u(D.animalTypeData,D.otherPetType)}),D.primaryBreed&&e.push({name:"Primary Breed",id:D.primaryBreed,value:u(D.breeds,D.primaryBreed)}),D.primaryColor&&e.push({name:"Primary Color",id:D.primaryColor,value:u(D.animalColorData,D.primaryColor)}),D.animalDescription&&e.push({name:"Description Of Animal",id:1*angular.element("#animalDescription").attr("data-cs-id"),value:D.animalDescription}),D.streetAddress&&e.push({name:"Complainant Address",id:D.streetAddressId,value:D.streetAddress}),D.city&&e.push({name:"Complainant City",id:D.cityId,value:D.city}),D.state){var t=D.state.id?D.state.id:D.state;e.push({name:"Complainant State",id:t,value:u(D.states,t)})}D.zipCode&&e.push({name:"Complainant Zip Code",id:D.zipCodeId,value:D.zipCode}),D.isLoading=!0,D.isDone=!0,r.post(e,function(e){D.isLoading=!1,D.isSuccess=!0,D.issueId=JSON.parse(e).CsResponse.ReportId},function(e){D.isLoading=!1,console.log(e)})}},D.loadSubCategories=function(e){if(!e)return void(D.subCategories=[]);angular.forEach(D.categoryData,function(t){s(),t.id==e&&(D.subCategories=t.types,t.states&&(D.states=t.states,D.state=t.states[0]),t.fields&&(D.streetAddressId=t.fields.streetAddress,D.cityId=t.fields.city,D.zipCodeId=t.fields.zipCode),D.isAnimal="pets and animals"===t.name.toLowerCase())})},D.nextClick=function(){d()?D.page++:o.citySourcedReporterForm.$setSubmitted()},D.prevClick=function(){D.page--},D.trackBreed=function(){angular.element.each(D.animalBreedData,function(e,t){if(t.id===D.petType.id)return D.breeds=t.breeds?t.breeds:[],D.sex=t.sex,!0})},D.lookupAddress=function(e){D.autocompleteResults=[],D.address=e,c(e)}}e.controller("BaltCoGoReporterCtrl",["$http","$scope","$timeout","mapServiceComposite","reportService",o])}(angular.module("baltcogoApp"),baltimoreCounty.utility.querystringer),function(e,t){"use strict";function o(e,o,n,a,r){function i(e){d.status=e.Status,d.isOpen="On Hold"===e.IsOpen?"on-hold":e.IsOpen?"open":"closed",d.id=e.Id,d.issueType=e.IssueType,d.dateCreated=e.DateCreated,d.dateUpdated=e.DateUpdated,d.description=e.Description,d.comments=e.comments,c=e.Longitude,u=e.Latitude,a.reverseGeocode(c,u,s,function(e){console.log(e)}),window.map=new google.maps.Map(document.getElementById("map"),settings)}function s(e){d.address=e.address.Street+", "+e.address.City+", "+e.address.State,d.isLoading=!1,o.$apply()}var c,u,d=this,l=t.getAsDictionary().reportId;d.isError=!1,d.isLoading=!0,d.isMapLoading=!0,l&&function(e,t){r.getById(e,t,function(e){console.log(e)})}(l,i)}e.controller("BaltCoGoViewerCtrl",["$http","$scope","$timeout","mapService","reportService",o])}(angular.module("baltcogoApp"),baltimoreCounty.utility.querystringer);