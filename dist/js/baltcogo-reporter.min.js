!function(){"use strict";angular.module("baltcogoApp",[])}(),function(e,t){"use strict";var o={urls:{geocodeServer:t.urls.api.geocodeServer,suggestions:t.urls.api.suggestions,createReport:t.urls.api.createReport,getReport:t.urls.api.getReport,getReportLatLng:t.urls.api.getReportLatLng,json:{animalBreeds:t.urls.json.animalBreeds,animalColors:t.urls.json.animalColors,animalTypes:t.urls.json.animalTypes,categories:t.urls.json.categories,petTypes:t.urls.json.petTypes}},locations:{courtHouse:{latitude:t.locations.courtHouse.latitude,longitude:t.locations.courtHouse.longitude}}};e.constant("CONSTANTS",o)}(angular.module("baltcogoApp"),baltimoreCounty.constants.baltCoGo),function(e){function t(e,t){function o(e){return e.replace(", USA","")}var a,r=function(){a&&a.setMap(null)},n=function(e,t){return new google.maps.Map(document.getElementById(e),t)},i=function(e,t,o){a&&a.setMap(null),a=new google.maps.Marker({position:{lat:t,lng:o},map:e,icon:"/sebin/n/f/icon-marker-my-report.png",draggable:!1,animation:google.maps.Animation.DROP})},s=function(o,a,r,n){e.get(t.urls.geocodeServer+"/reverseGeocode?location=%7B%22x%22%3A"+a+"%2C+%22y%22%3A"+o+"%7D&f=pjson").then(r,n)},u=function(o,a){var r=encodeURIComponent(o);e.get(t.urls.suggestions+r).then(function(e){var t=[];angular.forEach(e.data,function(e){t.push({address:e.StreetAddress+", "+e.City+", "+e.Zip,longitude:e.Longitude,latitude:e.Latitude})}),a(t)},function(e){console.log(e)})};return{clearMarkers:r,createMap:n,createMarker:i,pan:function(e,t,o){e.panTo({lat:t,lng:o})},removeCountry:o,reverseGeocode:s,suggestAddresses:u}}e.factory("mapServiceComposite",["$http","CONSTANTS",t])}(angular.module("baltcogoApp")),function(e){"use strict";function t(e,t){function o(o,a,r){var n={headers:{"Content-Type":"application/json"}};e.post(t.urls.createReport,o,n).then(function(e){a(e.data)},function(e){r(e)})}function a(o,a,r){e.get(t.urls.getReport+o).then(function(e){a(e.data)},function(e){r(e)})}function r(o,a,r){var n={headers:{"Content-Type":"application/json"}};e.post(t.urls.getReportLatLng,o,n).then(function(e){a(e.data)},function(e){r(e)})}return{post:o,getById:a,getNearby:r}}e.factory("reportService",["$http","CONSTANTS",t])}(angular.module("baltcogoApp")),function(e,t,o){"use strict";function a(e,a,r,n,i,s){function u(e){var t=$.shouldRequireLocation(),o=2===$.page;o&&!t&&($.latitude=s.locations.courtHouse.latitude,$.longitude=s.locations.courtHouse.longitude,$.page=e),o&&r(g,500)}function l(e,t){return!!e&&Object.prototype.hasOwnProperty.call(e,t)}function c(e){angular.forEach($.categoryData,function(t){t.id===e?($.category=t,$.loadSubCategories()):t.types&&angular.forEach(t.types,function(o){o.id===e&&($.category=t,$.loadSubCategories(),$.subCategory=o)})})}function d(){$.subCategory={},$.petType="",$.otherPetType="",$.petSex="",$.primaryColor="",$.primaryBreed="",$.animalDescription="",$.streetAddress="",$.city="",$.zipCode="",$.descriptionOfAnimalId=0,$.descriptionOfLocationId=0,$.otherDescriptionId=0,$.longitude=0,$.latitude=0}function p(e,t){var o="";return angular.forEach(e,function(e){return e.id===t&&(o=e.name,!0)}),o}function g(){var e=R.getCenter();google.maps.event.trigger(R,"resize"),R.setCenter(e)}function m(){var e=angular.element("#citysourced-reporter-form .panel:visible [required]"),t=e.length,o=a.citySourcedReporterForm.$$controls,r=!1,n=!0;angular.forEach(o,function(e){if(e.$$element.closest(".panel").is(":visible")){var t=e.$$element.is("#map-latitude"),o=e.$$element.is("#map-longitude"),a=e.$$element.is("#address"),i=0===$.latitude||0===$.longitude;e.$pristine&&e.$setDirty(),e.$untouched&&e.$setTouched(),(t||o||a)&&(r=!0,i&&(e.$setValidity("required",!1),n=!1))}});var i=e.filter(".ng-valid").length;return r?n:t===i}function f(e){var t=e.which||e.keyCode;if(40===t)return e.preventDefault(),void angular.element(".autocomplete-results button").first().focus();if(13!==t)if(46!==t&&8!==t||($.longitude=0,$.latitude=0),$.address&&$.address.trim().length>3){var o=$.address.trim().split(","),r=o[0];n.suggestAddresses(r,function(e){$.autocompleteResults=e})}else $.autocompleteResults=[];else if($.autocompleteResults.length>0){var i=angular.element(".autocomplete-results button").first();i.trigger("click"),a.$apply()}}function y(e){var t=e.which||e.keyCode,o=angular.element(e.target);o.is(".autocomplete-results button")&&(27===t&&angular.element(".autocomplete-results").is(":visible")&&($.autocompleteResults=[],a.$apply()),e.preventDefault(),13!==t&&32!==t||o.trigger("click"),40===t&&o.parent().next().find("button").focus(),38===t&&o.parent().prev().find("button").focus())}function C(e){$.animalTypeData=e.data}function v(e){$.animalBreedData=e.data}function h(e){$.categoryData=e.data,I&&c(I)}function b(e){$.animalColorData=e.data}function D(e){console.log(e)}function S(e){var t=angular.element("#map").closest("cs-form-control"),o=a.citySourcedReporterForm.address;$.autocompleteResults=[],$.latitude=e.latLng.lat(),$.longitude=e.latLng.lng(),n.reverseGeocode($.latitude,$.longitude,function(e){t.removeClass("error"),e.data.error?$.address=T(t,o):(n.createMarker(R,$.latitude,$.longitude),$.address=e.data.address.Street.toLowerCase()+", "+e.data.address.City.toLowerCase()+", "+e.data.address.State.toUpperCase())},function(){$.address=T(t,o)})}function T(e,t){return e.addClass("error"),t.$setDirty(),$.latitude=0,$.longitude=0,n.clearMarkers(),""}function A(e){$.petTypeData=e.data}function L(e){13===(e.which||e.keyCode)&&e.preventDefault()}var R,$=this,I=1*t.getAsDictionary().categoryid;$.isAnimal=!1,$.page=1,$.isDone=!1,$.isSuccess=!1,$.issueId="",$.isLoading=!1,$.latitude=0,$.longitude=0,$.category=0;var k={center:{lat:s.locations.courtHouse.latitude,lng:s.locations.courtHouse.longitude},scrollwheel:!1,zoom:14,mapTypeId:"roadmap",mapTypeControl:!1,streetViewControl:!1,gestureHandling:"greedy"};R=n.createMap("map",k),e.get(s.urls.json.animalBreeds).then(v,D),e.get(s.urls.json.animalColors).then(b,D),e.get(s.urls.json.animalTypes).then(C,D),e.get(s.urls.json.categories).then(h,D),e.get(s.urls.json.petTypes).then(A,D),google.maps.event.addListener(R,"click",S),angular.element(document).on("keyup keypress","#citysourced-reporter-form",L),angular.element(document).on("keyup","#address",f),angular.element(window).on("keydown",y),$.fileReportClick=function(){if(m()){var e=[{name:"Category",id:$.category.id,value:$.category.name},{name:"SubCategory",id:$.subCategory.id,value:$.subCategory.name},{name:"Description",id:$.descriptionId,value:$.description},{name:"Latitude",value:$.latitude},{name:"Longitude",value:$.longitude},{name:"FirstName",value:$.firstName},{name:"LastName",value:$.lastName},{name:"Email",value:$.email},{name:"DeviceNumber",value:o("phoneNumber",$.deviceNumber,"xxx-xxx-xxxx")}];$.otherDescription&&e.push({name:"Other Description",id:$.otherDescriptionId,value:$.otherDescription}),$.petType&&e.push({name:"Pet Type",id:$.petType.id,value:p($.petTypeData,$.petType.id)}),$.petSex&&e.push({name:"Sex",id:$.petSex.id,value:p($.sex,$.petSex.id)}),$.otherPetType&&e.push({name:"Other Pet Type",id:$.otherPetType,value:p($.animalTypeData,$.otherPetType)}),$.primaryBreed&&e.push({name:"Primary Breed",id:$.primaryBreed,value:p($.breeds,$.primaryBreed)}),$.primaryColor&&e.push({name:"Primary Color",id:$.primaryColor,value:p($.animalColorData,$.primaryColor)}),$.animalDescription&&e.push({name:"Description Of Animal",id:1*angular.element("#animalDescription").attr("data-cs-id"),value:$.animalDescription}),$.streetAddress&&e.push({name:"Complainant Address",id:$.streetAddressId,value:$.streetAddress}),$.city&&e.push({name:"Complainant City",id:$.cityId,value:$.city}),$.zipCode&&e.push({name:"Complainant Zip Code",id:$.zipCodeId,value:$.zipCode}),$.isLoading=!0,$.isDone=!0,i.post(e,function(e){$.isLoading=!1,$.isSuccess=!0,$.issueId=JSON.parse(e).CsResponse.ReportId},function(e){$.isLoading=!1,console.log(e)})}},$.loadSubCategories=function(){if(!$.category)return void($.subCategories=[]);angular.forEach($.categoryData,function(e){d(),e.id===$.category.id&&($.subCategories=e.types,e.states?($.states=e.states,$.state=e.states[0]):$.states=[],e.fields&&($.streetAddressId=e.fields.streetAddress,$.cityId=e.fields.city,$.zipCodeId=e.fields.zipCode),$.isAnimal=!!e.isAnimal,r(function(){e.descriptionOfAnimal&&($.descriptionOfAnimalId=e.descriptionOfAnimal),e.descriptionOfLocation&&($.descriptionOfLocationId=e.descriptionOfLocation),e.otherDescription&&($.otherDescriptionId=e.otherDescription)},0),$.descriptionId=e.description)})},$.nextClick=function(){m()?($.page+=1,u(3)):a.citySourcedReporterForm.$setSubmitted()},$.prevClick=function(){$.page-=1,u(1),2===$.page&&r(g,500)},$.setLocation=function(e,t,o){$.address=e.autocompleteResult.address,$.longitude=t,$.latitude=o,$.autocompleteResults=[],n.pan(R,o,t),n.createMarker(R,o,t)},$.shouldRequireLocation=function(){var e=l($.category,"requiresLocation"),t=l($.subCategory,"requiresLocation");return!e&&!t||(t?$.subCategory.requiresLocation:$.category.requiresLocation)},$.trackBreed=function(){angular.forEach($.animalBreedData,function(e){e.id===$.petType.id&&($.breeds=e.breeds?e.breeds:[],$.sex=e.sex)})}}e.controller("BaltCoGoReporterCtrl",["$http","$scope","$timeout","mapServiceComposite","reportService","CONSTANTS",a])}(angular.module("baltcogoApp"),baltimoreCounty.utility.querystringer,baltimoreCounty.utility.format);