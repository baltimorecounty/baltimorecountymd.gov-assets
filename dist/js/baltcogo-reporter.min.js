!function(){"use strict";angular.module("baltcogoApp",[])}(),function(e){"use strict";function t(e){function t(t,a,n){var o={headers:{"Content-Type":"application/json"}};e.post("https://testservices.baltimorecountymd.gov/api/baltcogo/createreport",t,o).then(function(e){a(e.data)},function(e){n(e)})}return{post:t}}e.factory("createReportService",["$http",t])}(angular.module("baltcogoApp")),function(e){"use strict";function t(e){function t(e){return!!a($.grep(e,n))&&e[0].formatted_address}function a(e){var t="";return e&&e.length&&(t=e[0].formatted_address),t.indexOf(l)!==-1}function n(e,t){return o(e,t,"administrative_area_level_2")}function o(e,t,a){var n;return e.types&&(n=$.grep(e.types,function(e,t){return e===a})),!!n.length&&n}function r(e){return e.replace(", USA","")}var i,s="AIzaSyAqazsw3wPSSxOFVmij32C_LIhBSuyUNi8",l="Baltimore County",u=function(){i&&i.setMap(null)},d=function(e,t){return new google.maps.places.Autocomplete(document.getElementById(e),t)},c=function(e,t){return new google.maps.Map(document.getElementById(e),t)};return{createMarker:function(e,t,a){i&&i.setMap(null),i=new google.maps.Marker({position:{lat:t,lng:a},map:e,draggable:!1,animation:google.maps.Animation.DROP})},reverseGeocode:function(a,n,o){var i=angular.element("#address");e.get("https://maps.googleapis.com/maps/api/geocode/json?latlng="+a+","+n+"&key="+s).then(function(e){var a=t(e.data.results);a?(i.parent().removeClass("error"),o(r(a))):(i.parent().addClass("error"),u(),o(""))})},addressLookup:function(t,a){e.get("https://maps.googleapis.com/maps/api/geocode/json?region=US&address="+t+"&key="+s).then(function(e){if(e.data.results.length){var t=e.data.results[0].geometry.location.lat,n=e.data.results[0].geometry.location.lng;a(e.data.results[0].formatted_address,t,n)}else a("")},function(e){console.log("error!",e)})},createMap:c,createAutoComplete:d,removeCountry:r}}e.factory("mapService",["$http",t])}(angular.module("baltcogoApp")),function(e,t,a){"use strict";function n(e,a,n,o,r){function i(){var e=angular.element(".pac-item").first();return e.find(".pac-item-query").text()+" "+e.find("> span").last().text()}function s(){a.$apply(function(){D.address=o.removeCountry(D.address)});var e=L.getPlace();if(e.geometry){var t=e.geometry.location.lat(),n=e.geometry.location.lng();D.latitude=t,D.longitude=n,o.reverseGeocode(t,n,function(e){D.address=l(e,t,n)})}}function l(e,t,a){return e?(o.createMarker(D.map,t,a),D.map.panTo({lat:t,lng:a}),e):""}function u(e){D.latitude=e.latLng.lat(),D.longitude=e.latLng.lng(),o.reverseGeocode(D.latitude,D.longitude,function(e){e&&(D.address=e,o.createMarker(D.map,D.latitude,D.longitude))})}function d(){var e=i();o.addressLookup(e,function(e,t,a){o.reverseGeocode(t,a,function(e){D.address=l(e,t,a),D.latitude=t,D.longitude=a})})}function c(){D.subCategory="",D.petType="",D.otherPetType="",D.petSex="",D.primaryColor="",D.primaryBreed="",D.animalDescription=""}function p(e){angular.forEach(D.categoryData,function(t){t.id===e?(D.category=t,D.loadSubCategories(t.id)):t.types&&angular.forEach(t.types,function(a){a.id===e&&(D.category=t,D.loadSubCategories(t.id),D.subCategory=a)})})}function m(e,t){var a="";return angular.forEach(e,function(e){if(e.id===t)return a=e.name,!0}),a}function g(){var e=angular.element("#citysourced-reporter-form .panel:visible [required]"),t=e.length,n=e.filter(".ng-valid").length,o=a.citySourcedReporterForm.$$controls;return angular.forEach(o,function(e,t,a){e.$$element.is(":visible")&&(e.$pristine&&e.$setDirty(),e.$untouched&&e.$setTouched())}),t===n}function f(e){D.categoryData=e.data,S&&p(S)}function y(e){D.animalBreedData=e.data}function v(e){D.animalColorData=e.data}function C(e){D.animalTypeData=e.data}function h(e){D.petTypeData=e.data}function b(e){console.log(e)}var D=this,S=1*t.getAsDictionary().categoryid;e.get("/sebin/y/z/animal-breeds.json").then(y,b),e.get("/sebin/u/t/animal-colors.json").then(v,b),e.get("/sebin/a/d/animal-types.json").then(C,b),e.get("/sebin/q/l/categories.json").then(f,b),e.get("/sebin/m/z/pet-types.json").then(h,b),D.isAnimal=!1,D.page=1,D.isDone=!1,D.isSuccess=!1,D.issueId="",D.isLoading=!1;var T={center:{lat:39.4003288,lng:-76.60652470000002},scrollwheel:!1,zoom:14,mapTypeId:"roadmap",mapTypeControl:!1,streetViewControl:!1},A={types:["geocode"]};D.map=o.createMap("map",T);var L=o.createAutoComplete("address",A);google.maps.event.addListener(D.map,"click",u),L.addListener("place_changed",s),document.getElementById("addressSearch").addEventListener("click",d),D.trackBreed=function(){angular.element.each(D.animalBreedData,function(e,t){if(t.id===D.petType.id)return D.breeds=t.breeds?t.breeds:[],D.sex=t.sex,!0})},D.loadSubCategories=function(e){if(!e)return void(D.subCategories=[]);angular.forEach(D.categoryData,function(t){c(),t.id==e&&(D.subCategories=t.types,t.states&&(D.states=t.states,D.state=t.states[0]),t.fields&&(D.streetAddressId=t.fields.streetAddress,D.cityId=t.fields.city,D.zipCodeId=t.fields.zipCode),D.isAnimal="pets and animals"===t.name.toLowerCase())})},D.nextClick=function(){g()?2===++D.page&&setTimeout(function(){google.maps.event.trigger(D.map,"resize")},500):a.citySourcedReporterForm.$setSubmitted()},D.prevClick=function(){2===--D.page&&setTimeout(function(){google.maps.event.trigger(D.map,"resize")},500)},D.fileReportClick=function(){if(g()){var e=[{name:"Category",id:D.category,value:m(D.categoryData,D.category)},{name:"SubCategory",id:D.subCategory,value:m(D.subCategories,D.subCategory)},{name:"Description",id:1*angular.element("#description").attr("data-cs-id"),value:D.description},{name:"Latitude",value:D.latitude},{name:"Longitude",value:D.longitude},{name:"FirstName",value:D.firstName},{name:"LastName",value:D.lastName},{name:"Email",value:D.email},{name:"DeviceNumber",value:D.deviceNumber}];if(D.locationDescription&&e.push({name:"Description Of Location",id:1*angular.element("#locationDescription").attr("data-cs-id"),value:D.locationDescription}),D.petType&&e.push({name:"Pet Type",id:D.petType.id,value:m(D.petTypeData,D.petType.id)}),D.petSex&&e.push({name:"Sex",id:D.petSex.id,value:m(D.sex,D.petSex.id)}),D.otherPetType&&e.push({name:"Other Pet Type",id:D.otherPetType,value:m(D.animalTypeData,D.otherPetType)}),D.primaryBreed&&e.push({name:"Primary Breed",id:D.primaryBreed,value:m(D.breeds,D.primaryBreed)}),D.primaryColor&&e.push({name:"Primary Color",id:D.primaryColor,value:m(D.animalColorData,D.primaryColor)}),D.animalDescription&&e.push({name:"Description Of Animal",id:1*angular.element("#animalDescription").attr("data-cs-id"),value:D.animalDescription}),D.streetAddress&&e.push({name:"Complainant Address",id:D.streetAddressId,value:D.streetAddress}),D.city&&e.push({name:"Complainant City",id:D.cityId,value:D.city}),D.state){var t=D.state.id?D.state.id:D.state;e.push({name:"Complainant State",id:t,value:m(D.states,t)})}D.zipCode&&e.push({name:"Complainant Zip Code",id:D.zipCodeId,value:D.zipCode}),D.isLoading=!0,D.isDone=!0,r.post(e,function(e){D.isLoading=!1,D.isSuccess=!0,D.issueId=JSON.parse(e).CsResponse.ReportId},function(e){D.isLoading=!1,console.log(e)})}}}e.controller("BaltCoGoReporterCtrl",["$http","$scope","$timeout","mapService","createReportService",n])}(angular.module("baltcogoApp"),baltimoreCounty.utility.querystringer,baltimoreCounty.utility.jsonTools);