!function(){"use strict";angular.module("baltcogoApp",[])}(),function(e,t){"use strict";var a={urls:{geocodeServer:t.urls.api.geocodeServer,suggestions:t.urls.api.suggestions,createReport:t.urls.api.createReport,getReport:t.urls.api.getReport,getReportLatLng:t.urls.api.getReportLatLng,json:{animalBreeds:t.urls.json.animalBreeds,animalColors:t.urls.json.animalColors,animalTypes:t.urls.json.animalTypes,categories:t.urls.json.categories,petTypes:t.urls.json.petTypes}},locations:{courtHouse:{latitude:t.locations.courtHouse.latitude,longitude:t.locations.courtHouse.longitude}}};e.constant("CONSTANTS",a)}(angular.module("baltcogoApp"),baltimoreCounty.constants.baltCoGo),function(e){function t(e,t){function a(e){return e.replace(", USA","")}var o,n=function(){o&&o.setMap(null)},r=function(e,t){return new google.maps.Map(document.getElementById(e),t)},i=function(e,t,a){o&&o.setMap(null),o=new google.maps.Marker({position:{lat:t,lng:a},map:e,icon:"/sebin/n/f/icon-marker-my-report.png",draggable:!1,animation:google.maps.Animation.DROP})},s=function(a,o,n,r){e.get(t.urls.geocodeServer+"/reverseGeocode?location=%7B%22x%22%3A"+o+"%2C+%22y%22%3A"+a+"%7D&f=pjson").then(n,r)},u=function(a,o){var n=encodeURIComponent(a);e.get(t.urls.suggestions+n).then(function(e){var t=[];angular.forEach(e.data,function(e){t.push({address:e.StreetAddress+", "+e.City+", "+e.Zip,longitude:e.Longitude,latitude:e.Latitude})}),o(t)},function(e){console.log(e)})};return{clearMarkers:n,createMap:r,createMarker:i,pan:function(e,t,a){e.panTo({lat:t,lng:a})},removeCountry:a,reverseGeocode:s,suggestAddresses:u}}e.factory("mapServiceComposite",["$http","CONSTANTS",t])}(angular.module("baltcogoApp")),function(e){"use strict";function t(e,t){function a(a,o,n){var r={headers:{"Content-Type":"application/json"}};e.post(t.urls.createReport,a,r).then(function(e){o(e.data)},function(e){n(e)})}function o(a,o,n){e.get(t.urls.getReport+a).then(function(e){o(e.data)},function(e){n(e)})}function n(a,o,n){var r={headers:{"Content-Type":"application/json"}};e.post(t.urls.getReportLatLng,a,r).then(function(e){o(e.data)},function(e){n(e)})}return{post:a,getById:o,getNearby:n}}e.factory("reportService",["$http","CONSTANTS",t])}(angular.module("baltcogoApp")),function(e,t,a){"use strict";function o(e,o,n,r,i,s){function u(e){angular.forEach(L.categoryData,function(t){t.id===e?(L.category=t,L.loadSubCategories()):t.types&&angular.forEach(t.types,function(a){a.id===e&&(L.category=t,L.loadSubCategories(),L.subCategory=a)})})}function l(){L.subCategory="",L.petType="",L.otherPetType="",L.petSex="",L.primaryColor="",L.primaryBreed="",L.animalDescription="",L.streetAddress="",L.city="",L.zipCode="",L.descriptionOfAnimalId=0,L.descriptionOfLocationId=0,L.otherDescriptionId=0}function c(e,t){var a="";return angular.forEach(e,function(e){return e.id===t&&(a=e.name,!0)}),a}function d(){var e=A.getCenter();google.maps.event.trigger(A,"resize"),A.setCenter(e)}function p(){var e=angular.element("#citysourced-reporter-form .panel:visible [required]"),t=e.length,a=o.citySourcedReporterForm.$$controls,n=!1,r=!0;angular.forEach(a,function(e){if(e.$$element.closest(".panel").is(":visible")){var t=e.$$element.is("#map-latitude"),a=e.$$element.is("#map-longitude"),o=e.$$element.is("#address"),i=0===L.latitude||0===L.longitude;e.$pristine&&e.$setDirty(),e.$untouched&&e.$setTouched(),(t||a||o)&&(n=!0,i&&(e.$setValidity("required",!1),r=!1))}});var i=e.filter(".ng-valid").length;return n?r:t===i}function g(e){var t=e.which||e.keyCode;if(40===t)return e.preventDefault(),void angular.element(".autocomplete-results button").first().focus();if(13!==t)if(46!==t&&8!==t||(L.longitude=0,L.latitude=0),L.address&&L.address.trim().length>3){var a=L.address.trim().split(","),n=a[0];r.suggestAddresses(n,function(e){L.autocompleteResults=e})}else L.autocompleteResults=[];else if(L.autocompleteResults.length>0){var i=angular.element(".autocomplete-results button").first();i.trigger("click"),o.$apply()}}function m(e){var t=e.which||e.keyCode,a=angular.element(e.target);a.is(".autocomplete-results button")&&(27===t&&angular.element(".autocomplete-results").is(":visible")&&(L.autocompleteResults=[],o.$apply()),e.preventDefault(),13!==t&&32!==t||a.trigger("click"),40===t&&a.parent().next().find("button").focus(),38===t&&a.parent().prev().find("button").focus())}function f(e){L.animalTypeData=e.data}function y(e){L.animalBreedData=e.data}function C(e){L.categoryData=e.data,R&&u(R)}function v(e){L.animalColorData=e.data}function h(e){console.log(e)}function b(e){var t=angular.element("#map").closest("cs-form-control"),a=o.citySourcedReporterForm.address;L.autocompleteResults=[],L.latitude=e.latLng.lat(),L.longitude=e.latLng.lng(),r.reverseGeocode(L.latitude,L.longitude,function(e){t.removeClass("error"),e.data.error?L.address=D(t,a):(r.createMarker(A,L.latitude,L.longitude),L.address=e.data.address.Street.toLowerCase()+", "+e.data.address.City.toLowerCase()+", "+e.data.address.State.toUpperCase())},function(e){L.address=D(t,a)})}function D(e,t){return e.addClass("error"),t.$setDirty(),L.latitude=0,L.longitude=0,r.clearMarkers(),""}function S(e){L.petTypeData=e.data}function T(e){13===(e.which||e.keyCode)&&e.preventDefault()}var A,L=this,R=1*t.getAsDictionary().categoryid;L.isAnimal=!1,L.page=1,L.isDone=!1,L.isSuccess=!1,L.issueId="",L.isLoading=!1,L.latitude=0,L.longitude=0,L.category=0;var $={center:{lat:s.locations.courtHouse.latitude,lng:s.locations.courtHouse.longitude},scrollwheel:!1,zoom:14,mapTypeId:"roadmap",mapTypeControl:!1,streetViewControl:!1,gestureHandling:"greedy"};A=r.createMap("map",$),e.get(s.urls.json.animalBreeds).then(y,h),e.get(s.urls.json.animalColors).then(v,h),e.get(s.urls.json.animalTypes).then(f,h),e.get(s.urls.json.categories).then(C,h),e.get(s.urls.json.petTypes).then(S,h),google.maps.event.addListener(A,"click",b),angular.element(document).on("keyup keypress","#citysourced-reporter-form",T),angular.element(document).on("keyup","#address",g),angular.element(window).on("keydown",m),L.fileReportClick=function(){if(p()){var e=[{name:"Category",id:L.category.id,value:L.category.name},{name:"SubCategory",id:L.subCategory.id,value:L.subCategory.name},{name:"Description",id:L.descriptionId,value:L.description},{name:"Latitude",value:L.latitude},{name:"Longitude",value:L.longitude},{name:"FirstName",value:L.firstName},{name:"LastName",value:L.lastName},{name:"Email",value:L.email},{name:"DeviceNumber",value:a("phoneNumber",L.deviceNumber,"xxx-xxx-xxxx")}];L.locationDescription&&e.push({name:"Description Of Location",id:L.descriptionOfLocationId,value:L.locationDescription}),L.otherDescription&&e.push({name:"Other Description",id:L.otherDescriptionId,value:L.otherDescription}),L.petType&&e.push({name:"Pet Type",id:L.petType.id,value:c(L.petTypeData,L.petType.id)}),L.petSex&&e.push({name:"Sex",id:L.petSex.id,value:c(L.sex,L.petSex.id)}),L.otherPetType&&e.push({name:"Other Pet Type",id:L.otherPetType,value:c(L.animalTypeData,L.otherPetType)}),L.primaryBreed&&e.push({name:"Primary Breed",id:L.primaryBreed,value:c(L.breeds,L.primaryBreed)}),L.primaryColor&&e.push({name:"Primary Color",id:L.primaryColor,value:c(L.animalColorData,L.primaryColor)}),L.animalDescription&&e.push({name:"Description Of Animal",id:1*angular.element("#animalDescription").attr("data-cs-id"),value:L.animalDescription}),L.streetAddress&&e.push({name:"Complainant Address",id:L.streetAddressId,value:L.streetAddress}),L.city&&e.push({name:"Complainant City",id:L.cityId,value:L.city}),L.zipCode&&e.push({name:"Complainant Zip Code",id:L.zipCodeId,value:L.zipCode}),L.isLoading=!0,L.isDone=!0,i.post(e,function(e){L.isLoading=!1,L.isSuccess=!0,L.issueId=JSON.parse(e).CsResponse.ReportId},function(e){L.isLoading=!1,console.log(e)})}},L.loadSubCategories=function(){if(!L.category)return void(L.subCategories=[]);angular.forEach(L.categoryData,function(e){l(),e.id===L.category.id&&(L.subCategories=e.types,e.states?(L.states=e.states,L.state=e.states[0]):L.states=[],e.fields&&(L.streetAddressId=e.fields.streetAddress,L.cityId=e.fields.city,L.zipCodeId=e.fields.zipCode),L.isAnimal="pets and animals"===e.name.toLowerCase(),n(function(){e.descriptionOfAnimal&&(L.descriptionOfAnimalId=e.descriptionOfAnimal),e.descriptionOfLocation&&(L.descriptionOfLocationId=e.descriptionOfLocation),e.otherDescription&&(L.otherDescriptionId=e.otherDescription)},0),L.descriptionId=e.description)})},L.nextClick=function(){p()?(L.page+=1,2===L.page&&"Website"===L.category.name&&(L.latitude=s.locations.courtHouse.latitude,L.longitude=s.locations.courtHouse.longitude,L.page=3),2===L.page&&n(d,500)):o.citySourcedReporterForm.$setSubmitted()},L.prevClick=function(){L.page-=1,2===L.page&&"Website"===L.category.name&&(L.latitude=s.locations.courtHouse.latitude,L.longitude=s.locations.courtHouse.longitude,L.page=1),2===L.page&&n(d,500)},L.setLocation=function(e,t,a){L.address=e.autocompleteResult.address,L.longitude=t,L.latitude=a,L.autocompleteResults=[],r.pan(A,a,t),r.createMarker(A,a,t)},L.trackBreed=function(){angular.forEach(L.animalBreedData,function(e){e.id===L.petType.id&&(L.breeds=e.breeds?e.breeds:[],L.sex=e.sex)})}}e.controller("BaltCoGoReporterCtrl",["$http","$scope","$timeout","mapServiceComposite","reportService","CONSTANTS",o])}(angular.module("baltcogoApp"),baltimoreCounty.utility.querystringer,baltimoreCounty.utility.format);