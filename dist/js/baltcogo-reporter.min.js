!function(){"use strict";angular.module("baltcogoApp",[])}(),function(e){"use strict";function t(e){function t(t,a,n){var o={headers:{"Content-Type":"application/json"}};e.post("http://ba224964:1000/api/baltcogo/createreport",t,o).then(function(e){a(e.data)},function(e){n(e)})}return{post:t}}e.factory("createReportService",["$http",t])}(angular.module("baltcogoApp")),function(e){"use strict";function t(e){function t(e){return!!a($.grep(e,n))&&e[0].formatted_address}function a(e){var t="";return e&&e.length&&(t=e[0].formatted_address),t.indexOf(l)!==-1}function n(e,t){return o(e,t,"administrative_area_level_2")}function o(e,t,a){var n;return e.types&&(n=$.grep(e.types,function(e,t){return e===a})),!!n.length&&n}function r(e){return e.replace(", USA","")}var i,s="AIzaSyAqazsw3wPSSxOFVmij32C_LIhBSuyUNi8",l="Baltimore County",d=function(){i&&i.setMap(null)},u=function(e,t){return new google.maps.places.Autocomplete(document.getElementById(e),t)},c=function(e,t){return new google.maps.Map(document.getElementById(e),t)};return{createMarker:function(e,t,a){i&&i.setMap(null),i=new google.maps.Marker({position:{lat:t,lng:a},map:e,draggable:!1,animation:google.maps.Animation.DROP})},reverseGeocode:function(a,n,o){var i=angular.element("#address");e.get("https://maps.googleapis.com/maps/api/geocode/json?latlng="+a+","+n+"&key="+s).then(function(e){var a=t(e.data.results);a?(i.parent().removeClass("error"),o(r(a))):(i.parent().addClass("error"),d(),o(""))})},addressLookup:function(t,a){e.get("https://maps.googleapis.com/maps/api/geocode/json?bounds=39.4579705,-76.8882835|39.7264469,-76.3322764&region=US&address="+t+"&key="+s).then(function(e){if(e.data.results.length){var t=e.data.results[0].geometry.location.lat,n=e.data.results[0].geometry.location.lng;a(e.data.results[0].formatted_address,t,n)}else a("")},function(e){console.log("error!",e)})},createMap:c,createAutoComplete:u,removeCountry:r}}e.factory("mapService",["$http",t])}(angular.module("baltcogoApp")),function(e){"use strict";function t(e,t,a,n,o){function r(e){if(13===e.which||13===e.keyCode){e.preventDefault();var t=new google.maps.places.AutocompleteService;console.log("self.address",h.address),t.getQueryPredictions({input:h.address},function(e){console.log(e)})}}function i(){h.address=n.removeCountry(h.address);var e=D.getPlace();if(e.geometry){var t=e.geometry.location.lat(),a=e.geometry.location.lng();n.reverseGeocode(t,a,function(e){h.address=s(e,t,a)})}}function s(e,t,a){return e?(n.createMarker(h.map,t,a),h.map.panTo({lat:t,lng:a}),e):""}function l(e){h.latitude=e.latLng.lat(),h.longitude=e.latLng.lng(),n.reverseGeocode(h.latitude,h.longitude,function(e){e&&(h.address=e,n.createMarker(h.map,h.latitude,h.longitude))})}function d(){n.addressLookup(h.address,function(e,t,a){n.reverseGeocode(t,a,function(e){h.address=s(e,t,a)})})}function u(e,t){var a="";return angular.forEach(e,function(e){if(e.id===t)return a=e.name,!0}),a}function c(){var e=angular.element("#citysourced-reporter-form .panel:visible [required]"),a=e.length,n=e.filter(".ng-valid").length,o=t.citySourcedReporterForm.$$controls;return angular.forEach(o,function(e,t,a){e.$$element.is(":visible")&&e.$pristine&&e.$setDirty()}),a===n}function p(e){h.categoryData=e.data}function m(e){h.animalBreedData=e.data}function g(e){h.animalColorData=e.data}function f(e){h.animalTypeData=e.data}function y(e){h.petTypeData=e.data}function v(e){console.log(e)}var h=this;e.get("categories.json").then(p,v),e.get("animal-breeds.json").then(m,v),e.get("animal-colors.json").then(g,v),e.get("animal-types.json").then(f,v),e.get("pet-types.json").then(y,v),h.isAnimal=!1,h.page=1,h.isDone=!1,h.isSuccess=!1,h.issueId="",h.isLoading=!1;var C={center:{lat:39.4003288,lng:-76.60652470000002},scrollwheel:!1,zoom:14,mapTypeId:"roadmap",mapTypeControl:!1,streetViewControl:!1},b={types:["geocode"]};h.map=n.createMap("map",C);var D=n.createAutoComplete("address",b);google.maps.event.addListener(h.map,"click",l),D.addListener("place_changed",i),document.getElementById("addressSearch").addEventListener("click",d),document.getElementById("address").addEventListener("keyup",r),h.trackBreed=function(){angular.element.each(h.animalBreedData,function(e,t){if(t.id===h.petType.id)return h.breeds=t.breeds?t.breeds:[],h.sex=t.sex,!0})},h.loadSubCategories=function(e){if(!e)return void(h.subCategories=[]);angular.forEach(h.categoryData,function(t){t.id==e&&(h.subCategories=t.types,t.states&&(h.states=t.states,h.state=t.states[23]),t.fields&&(h.streetAddressId=t.fields.streetAddress,h.cityId=t.fields.city,h.zipCodeId=t.fields.zipCode),h.isAnimal="pets and animals"===t.name.toLowerCase())})},h.nextClick=function(){c()?(h.page++,setTimeout(function(){google.maps.event.trigger(h.map,"resize")},500)):t.citySourcedReporterForm.$setSubmitted()},h.prevClick=function(){h.page--,setTimeout(function(){google.maps.event.trigger(h.map,"resize")},500)},h.fileReportClick=function(){if(c()){var e=[{name:"Category",id:h.category,value:u(h.categoryData,h.category)},{name:"SubCategory",id:h.subCategory,value:u(h.subCategories,h.subCategory)},{name:"Description",id:1*angular.element("#description").attr("data-cs-id"),value:h.description},{name:"Description Of Location",id:1*angular.element("#locationDescription").attr("data-cs-id"),value:h.locationDescription},{name:"Latitude",value:h.latitude},{name:"Longitude",value:h.longitude},{name:"FirstName",value:h.firstName},{name:"LastName",value:h.lastName},{name:"Email",value:h.email},{name:"DeviceNumber",value:h.deviceNumber}];if(h.petType&&e.push({name:"Pet Type",id:h.petType.id,value:u(h.petTypeData,h.petType.id)}),h.petSex&&e.push({name:"Sex",id:h.petSex.id,value:u(h.sex,h.petSex.id)}),h.otherPetType&&e.push({name:"Other Pet Type",id:h.otherPetType,value:u(h.animalTypeData,h.otherPetType)}),h.primaryBreed&&e.push({name:"Primary Breed",id:h.primaryBreed,value:u(h.breeds,h.primaryBreed)}),h.primaryColor&&e.push({name:"Primary Color",id:h.primaryColor,value:u(h.animalColorData,h.primaryColor)}),h.animalDescription&&e.push({name:"Description Of Animal",id:1*angular.element("#animalDescription").attr("data-cs-id"),value:h.animalDescription}),h.streetAddress&&e.push({name:"Complainant Address",id:h.streetAddressId,value:h.streetAddress}),h.city&&e.push({name:"Complainant City",id:h.cityId,value:h.city}),h.state){var t=h.state.id?h.state.id:h.state;e.push({name:"Complainant State",id:t,value:u(h.states,t)})}h.zipCode&&e.push({name:"Complainant Zip Code",id:h.zipCodeId,value:h.zipCode}),h.isLoading=!0,h.isDone=!0,o.post(e,function(e){h.isLoading=!1,h.isSuccess=!0,h.issueId=JSON.parse(e).CsResponse.ReportId},function(e){h.isLoading=!1,console.log(e)})}}}e.controller("BaltCoGoReporterCtrl",["$http","$scope","$timeout","mapService","createReportService",t])}(angular.module("baltcogoApp"));