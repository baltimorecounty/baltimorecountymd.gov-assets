!function(){"use strict";angular.module("baltcogoApp",[])}(),function(e){"use strict";function t(e){function t(t,a,r){var n={headers:{"Content-Type":"application/json"}};e.post("https://testservices.baltimorecountymd.gov/api/baltcogo/createreport",t,n).then(function(e){a(e.data)},function(e){r(e)})}return{post:t}}e.factory("createReportService",["$http",t])}(angular.module("baltcogoApp")),function(e){"use strict";function t(e){function t(e){var t=$.grep(e,a),r="";return t&&t.length&&(r=t[0].formatted_address),r.indexOf(s)!==-1&&r}function a(e,t){return r(e,t,"administrative_area_level_2")}function r(e,t,a){var r;return e.types&&(r=$.grep(e.types,function(e,t){return e===a})),!!r.length&&r}function n(e){return e.replace(", USA","")}var o,i="AIzaSyAqazsw3wPSSxOFVmij32C_LIhBSuyUNi8",s="Baltimore County",l=function(){o&&o.setMap(null)},u=function(e,t){return new google.maps.places.Autocomplete(document.getElementById(e),t)},d=function(e,t){return new google.maps.Map(document.getElementById(e),t)};return{createMarker:function(e,t,a){o&&o.setMap(null),o=new google.maps.Marker({position:{lat:t,lng:a},map:e,icon:"/sebin/n/f/icon-marker-my-report.png",draggable:!1,animation:google.maps.Animation.DROP})},reverseGeocode:function(a,r,n){e.get("https://maps.googleapis.com/maps/api/geocode/json?latlng="+a+","+r+"&key="+i).then(function(e){var a=e.data.results[0].formatted_address;t(e.data.results)?n(a):(l(),n(""))})},addressLookup:function(t,a){e.get("https://maps.googleapis.com/maps/api/geocode/json?region=US&address="+t+"&key="+i).then(function(e){if(e.data.results.length){var t=e.data.results[0].geometry.location.lat,r=e.data.results[0].geometry.location.lng;a(e.data.results[0].formatted_address,t,r)}else a("")},function(e){console.log("error!",e)})},createMap:d,createAutoComplete:u,removeCountry:n,pan:function(e,t,a){e.panTo({lat:t,lng:a})}}}e.factory("mapService",["$http",t])}(angular.module("baltcogoApp")),function(e,t){"use strict";function a(e,a,r,n,o){function i(e){angular.forEach(T.categoryData,function(t){t.id===e?(T.category=t,T.loadSubCategories(t.id)):t.types&&angular.forEach(t.types,function(a){a.id===e&&(T.category=t,T.loadSubCategories(t.id),T.subCategory=a)})})}function s(){T.subCategory="",T.petType="",T.otherPetType="",T.petSex="",T.primaryColor="",T.primaryBreed="",T.animalDescription=""}function l(e,t){var a="";return angular.forEach(e,function(e){if(e.id===t)return a=e.name,!0}),a}function u(){var e=angular.element(".pac-item").first();return e.find(".pac-item-query").text()+" "+e.find("> span").last().text()}function d(){var e=angular.element("#citysourced-reporter-form .panel:visible [required]"),t=e.length,r=e.filter(".ng-valid").length,n=a.citySourcedReporterForm.$$controls;return angular.forEach(n,function(e,t,a){e.$$element.closest(".panel").is(":visible")&&(e.$pristine&&e.$setDirty(),e.$untouched&&e.$setTouched(),e.$$element.is("#address")&&(angular.element("#map-latitude").is(".ng-invalid")||angular.element("#map-longitude").is(".ng-invalid"))&&e.$setValidity("required",!1))}),t===r}function c(e){13===(e.which||e.keyCode)&&r(function(){L.getPlace()&&L.getPlace().formatted_address||p()},250)}function p(){if(T.address){var e=u(),t=(a.citySourcedReporterForm.address,angular.element("#map").closest("cs-form-control"));n.addressLookup(e,function(a,r,o){r&&o?n.reverseGeocode(r,o,function(a){a?(t.removeClass("error"),T.address=n.removeCountry(e),n.createMarker(T.map,r,o),n.pan(T.map,r,o)):C()}):C()})}}function m(e){T.animalTypeData=e.data}function m(e){T.animalTypeData=e.data}function g(){a.$apply(function(){T.address=n.removeCountry(T.address)});var e=L.getPlace();if(e.geometry){var t=e.geometry.location.lat(),r=e.geometry.location.lng();T.latitude=t,T.longitude=r,n.reverseGeocode(t,r,function(e){e?(n.createMarker(T.map,t,r),n.pan(T.map,t,r)):C()})}}function f(e){T.animalBreedData=e.data}function y(e){T.categoryData=e.data,$&&i($)}function v(e){T.animalColorData=e.data}function C(){angular.element("#map").closest("cs-form-control").addClass("error"),a.citySourcedReporterForm.address.$setDirty(),T.address=""}function h(e){console.log(e)}function b(e){var t=angular.element("#map").closest("cs-form-control"),r=a.citySourcedReporterForm.address;T.latitude=e.latLng.lat(),T.longitude=e.latLng.lng(),n.reverseGeocode(T.latitude,T.longitude,function(e){e?(t.removeClass("error"),n.createMarker(T.map,T.latitude,T.longitude),T.address=n.removeCountry(e)):(t.addClass("error"),r.$setDirty(),T.address="")})}function D(e){T.petTypeData=e.data}function S(e){13===(e.which||e.keyCode)&&e.preventDefault()}var T=this,$=1*t.getAsDictionary().categoryid;e.get("/sebin/y/z/animal-breeds.json").then(f,h),e.get("/sebin/u/t/animal-colors.json").then(v,h),e.get("/sebin/a/d/animal-types.json").then(m,h),e.get("/sebin/q/l/categories.json").then(y,h),e.get("/sebin/m/z/pet-types.json").then(D,h),T.isAnimal=!1,T.page=1,T.isDone=!1,T.isSuccess=!1,T.issueId="",T.isLoading=!1;var A={center:{lat:39.4001857,lng:-76.6063945},scrollwheel:!1,zoom:14,mapTypeId:"roadmap",mapTypeControl:!1,streetViewControl:!1},k={types:["geocode"]};T.map=n.createMap("map",A);var L=n.createAutoComplete("address",k);angular.element("#citysourced-reporter-form").on("keyup keypress",S),google.maps.event.addListener(T.map,"click",b),L.addListener("place_changed",g),angular.element("#address").on("keyup",c),T.fileReportClick=function(){if(d()){var e=[{name:"Category",id:T.category,value:l(T.categoryData,T.category)},{name:"SubCategory",id:T.subCategory,value:l(T.subCategories,T.subCategory)},{name:"Description",id:1*angular.element("#description").attr("data-cs-id"),value:T.description},{name:"Latitude",value:T.latitude},{name:"Longitude",value:T.longitude},{name:"FirstName",value:T.firstName},{name:"LastName",value:T.lastName},{name:"Email",value:T.email},{name:"DeviceNumber",value:T.deviceNumber}];if(T.locationDescription&&e.push({name:"Description Of Location",id:1*angular.element("#locationDescription").attr("data-cs-id"),value:T.locationDescription}),T.petType&&e.push({name:"Pet Type",id:T.petType.id,value:l(T.petTypeData,T.petType.id)}),T.petSex&&e.push({name:"Sex",id:T.petSex.id,value:l(T.sex,T.petSex.id)}),T.otherPetType&&e.push({name:"Other Pet Type",id:T.otherPetType,value:l(T.animalTypeData,T.otherPetType)}),T.primaryBreed&&e.push({name:"Primary Breed",id:T.primaryBreed,value:l(T.breeds,T.primaryBreed)}),T.primaryColor&&e.push({name:"Primary Color",id:T.primaryColor,value:l(T.animalColorData,T.primaryColor)}),T.animalDescription&&e.push({name:"Description Of Animal",id:1*angular.element("#animalDescription").attr("data-cs-id"),value:T.animalDescription}),T.streetAddress&&e.push({name:"Complainant Address",id:T.streetAddressId,value:T.streetAddress}),T.city&&e.push({name:"Complainant City",id:T.cityId,value:T.city}),T.state){var t=T.state.id?T.state.id:T.state;e.push({name:"Complainant State",id:t,value:l(T.states,t)})}T.zipCode&&e.push({name:"Complainant Zip Code",id:T.zipCodeId,value:T.zipCode}),T.isLoading=!0,T.isDone=!0,o.post(e,function(e){T.isLoading=!1,T.isSuccess=!0,T.issueId=JSON.parse(e).CsResponse.ReportId},function(e){T.isLoading=!1,console.log(e)})}},T.loadSubCategories=function(e){if(!e)return void(T.subCategories=[]);angular.forEach(T.categoryData,function(t){s(),t.id==e&&(T.subCategories=t.types,t.states&&(T.states=t.states,T.state=t.states[0]),t.fields&&(T.streetAddressId=t.fields.streetAddress,T.cityId=t.fields.city,T.zipCodeId=t.fields.zipCode),T.isAnimal="pets and animals"===t.name.toLowerCase())})},T.nextClick=function(){d()?2===++T.page&&setTimeout(function(){var e=T.map.getCenter();google.maps.event.trigger(T.map,"resize"),T.map.setCenter(e)},500):a.citySourcedReporterForm.$setSubmitted()},T.prevClick=function(){2===--T.page&&setTimeout(function(){var e=T.map.getCenter();google.maps.event.trigger(T.map,"resize"),T.map.setCenter(e)},500)},T.trackBreed=function(){angular.element.each(T.animalBreedData,function(e,t){if(t.id===T.petType.id)return T.breeds=t.breeds?t.breeds:[],T.sex=t.sex,!0})}}e.controller("BaltCoGoReporterCtrl",["$http","$scope","$timeout","mapService","createReportService",a])}(angular.module("baltcogoApp"),baltimoreCounty.utility.querystringer);