!function(){"use strict";angular.module("baltcogoApp",[])}(),function(e){"use strict";function t(e){function t(t,a,r){var n={headers:{"Content-Type":"application/json"}};e.post("https://testservices.baltimorecountymd.gov/api/baltcogo/createreport",t,n).then(function(e){a(e.data)},function(e){r(e)})}return{post:t}}e.factory("createReportService",["$http",t])}(angular.module("baltcogoApp")),function(e){"use strict";function t(e){function t(e){var t=$.grep(e,a),r="";return t&&t.length&&(r=t[0].formatted_address),r.indexOf(s)!==-1&&r}function a(e,t){return r(e,t,"administrative_area_level_2")}function r(e,t,a){var r;return e.types&&(r=$.grep(e.types,function(e,t){return e===a})),!!r.length&&r}function n(e){return e.replace(", USA","")}var o,i="AIzaSyAqazsw3wPSSxOFVmij32C_LIhBSuyUNi8",s="Baltimore County",l=function(){o&&o.setMap(null)},u=function(e,t){return new google.maps.places.Autocomplete(document.getElementById(e),t)},c=function(e,t){return new google.maps.Map(document.getElementById(e),t)};return{createMarker:function(e,t,a){o&&o.setMap(null),o=new google.maps.Marker({position:{lat:t,lng:a},map:e,draggable:!1,animation:google.maps.Animation.DROP})},reverseGeocode:function(a,r,n){e.get("https://maps.googleapis.com/maps/api/geocode/json?latlng="+a+","+r+"&key="+i).then(function(e){var a=e.data.results[0].formatted_address;t(e.data.results)?n(a):(l(),n(""))})},addressLookup:function(t,a){e.get("https://maps.googleapis.com/maps/api/geocode/json?region=US&address="+t+"&key="+i).then(function(e){if(e.data.results.length){var t=e.data.results[0].geometry.location.lat,r=e.data.results[0].geometry.location.lng;a(e.data.results[0].formatted_address,t,r)}else a("")},function(e){console.log("error!",e)})},createMap:c,createAutoComplete:u,removeCountry:n,pan:function(e,t,a){e.panTo({lat:t,lng:a})}}}e.factory("mapService",["$http",t])}(angular.module("baltcogoApp")),function(e,t){"use strict";function a(e,a,r,n,o){function i(e){angular.forEach(S.categoryData,function(t){t.id===e?(S.category=t,S.loadSubCategories(t.id)):t.types&&angular.forEach(t.types,function(a){a.id===e&&(S.category=t,S.loadSubCategories(t.id),S.subCategory=a)})})}function s(){S.subCategory="",S.petType="",S.otherPetType="",S.petSex="",S.primaryColor="",S.primaryBreed="",S.animalDescription=""}function l(e,t){var a="";return angular.forEach(e,function(e){if(e.id===t)return a=e.name,!0}),a}function u(){var e=angular.element(".pac-item").first();return e.find(".pac-item-query").text()+" "+e.find("> span").last().text()}function c(){var e=angular.element("#citysourced-reporter-form .panel:visible [required]"),t=e.length,r=e.filter(".ng-valid").length,n=a.citySourcedReporterForm.$$controls;return angular.forEach(n,function(e,t,a){e.$$element.is(":visible")&&(e.$pristine&&e.$setDirty(),e.$untouched&&e.$setTouched())}),t===r}function d(e){13===(e.which||e.keyCode)&&r(function(){$.getPlace()&&$.getPlace().formatted_address||angular.element("#addressSearch").trigger("click")},250)}function p(){if(S.address){var e=u(),t=a.citySourcedReporterForm.address,r=angular.element("#map").closest("cs-form-control");n.addressLookup(e,function(a,o,i){n.reverseGeocode(o,i,function(a){a?(r.removeClass("error"),S.address=n.removeCountry(e),n.createMarker(S.map,o,i),n.pan(S.map,o,i)):(r.addClass("error"),t.$setDirty(),S.address="")})})}}function m(e){S.animalTypeData=e.data}function m(e){S.animalTypeData=e.data}function g(){a.$apply(function(){S.address=n.removeCountry(S.address)});var e=$.getPlace();if(e.geometry){var t=e.geometry.location.lat(),r=e.geometry.location.lng();S.latitude=t,S.longitude=r,n.reverseGeocode(t,r,function(e){e&&(n.createMarker(S.map,t,r),n.pan(S.map,t,r))})}}function f(e){S.animalBreedData=e.data}function y(e){S.categoryData=e.data,T&&i(T)}function v(e){S.animalColorData=e.data}function C(e){console.log(e)}function h(e){var t=angular.element("#map").closest("cs-form-control"),r=a.citySourcedReporterForm.address;S.latitude=e.latLng.lat(),S.longitude=e.latLng.lng(),n.reverseGeocode(S.latitude,S.longitude,function(e){e?(t.removeClass("error"),n.createMarker(S.map,S.latitude,S.longitude),S.address=n.removeCountry(e)):(t.addClass("error"),r.$setDirty(),S.address="")})}function b(e){S.petTypeData=e.data}function D(e){13===(e.which||e.keyCode)&&e.preventDefault()}var S=this,T=1*t.getAsDictionary().categoryid;e.get("/sebin/y/z/animal-breeds.json").then(f,C),e.get("/sebin/u/t/animal-colors.json").then(v,C),e.get("/sebin/a/d/animal-types.json").then(m,C),e.get("/sebin/q/l/categories.json").then(y,C),e.get("/sebin/m/z/pet-types.json").then(b,C),S.isAnimal=!1,S.page=1,S.isDone=!1,S.isSuccess=!1,S.issueId="",S.isLoading=!1;var k={center:{lat:39.4001857,lng:-76.6063945},scrollwheel:!1,zoom:14,mapTypeId:"roadmap",mapTypeControl:!1,streetViewControl:!1},A={types:["geocode"]};S.map=n.createMap("map",k);var $=n.createAutoComplete("address",A);angular.element("#citysourced-reporter-form").on("keyup keypress",D),google.maps.event.addListener(S.map,"click",h),$.addListener("place_changed",g),angular.element("#addressSearch").on("click",p),angular.element("#address").on("keyup",d),S.fileReportClick=function(){if(c()){var e=[{name:"Category",id:S.category,value:l(S.categoryData,S.category)},{name:"SubCategory",id:S.subCategory,value:l(S.subCategories,S.subCategory)},{name:"Description",id:1*angular.element("#description").attr("data-cs-id"),value:S.description},{name:"Latitude",value:S.latitude},{name:"Longitude",value:S.longitude},{name:"FirstName",value:S.firstName},{name:"LastName",value:S.lastName},{name:"Email",value:S.email},{name:"DeviceNumber",value:S.deviceNumber}];if(S.locationDescription&&e.push({name:"Description Of Location",id:1*angular.element("#locationDescription").attr("data-cs-id"),value:S.locationDescription}),S.petType&&e.push({name:"Pet Type",id:S.petType.id,value:l(S.petTypeData,S.petType.id)}),S.petSex&&e.push({name:"Sex",id:S.petSex.id,value:l(S.sex,S.petSex.id)}),S.otherPetType&&e.push({name:"Other Pet Type",id:S.otherPetType,value:l(S.animalTypeData,S.otherPetType)}),S.primaryBreed&&e.push({name:"Primary Breed",id:S.primaryBreed,value:l(S.breeds,S.primaryBreed)}),S.primaryColor&&e.push({name:"Primary Color",id:S.primaryColor,value:l(S.animalColorData,S.primaryColor)}),S.animalDescription&&e.push({name:"Description Of Animal",id:1*angular.element("#animalDescription").attr("data-cs-id"),value:S.animalDescription}),S.streetAddress&&e.push({name:"Complainant Address",id:S.streetAddressId,value:S.streetAddress}),S.city&&e.push({name:"Complainant City",id:S.cityId,value:S.city}),S.state){var t=S.state.id?S.state.id:S.state;e.push({name:"Complainant State",id:t,value:l(S.states,t)})}S.zipCode&&e.push({name:"Complainant Zip Code",id:S.zipCodeId,value:S.zipCode}),S.isLoading=!0,S.isDone=!0,o.post(e,function(e){S.isLoading=!1,S.isSuccess=!0,S.issueId=JSON.parse(e).CsResponse.ReportId},function(e){S.isLoading=!1,console.log(e)})}},S.loadSubCategories=function(e){if(!e)return void(S.subCategories=[]);angular.forEach(S.categoryData,function(t){s(),t.id==e&&(S.subCategories=t.types,t.states&&(S.states=t.states,S.state=t.states[0]),t.fields&&(S.streetAddressId=t.fields.streetAddress,S.cityId=t.fields.city,S.zipCodeId=t.fields.zipCode),S.isAnimal="pets and animals"===t.name.toLowerCase())})},S.nextClick=function(){c()?2===++S.page&&setTimeout(function(){var e=S.map.getCenter();google.maps.event.trigger(S.map,"resize"),S.map.setCenter(e)},500):a.citySourcedReporterForm.$setSubmitted()},S.prevClick=function(){2===--S.page&&setTimeout(function(){var e=S.map.getCenter();google.maps.event.trigger(S.map,"resize"),S.map.setCenter(e)},500)},S.trackBreed=function(){angular.element.each(S.animalBreedData,function(e,t){if(t.id===S.petType.id)return S.breeds=t.breeds?t.breeds:[],S.sex=t.sex,!0})}}e.controller("BaltCoGoReporterCtrl",["$http","$scope","$timeout","mapService","createReportService",a])}(angular.module("baltcogoApp"),baltimoreCounty.utility.querystringer);