!function(){"use strict";angular.module("baltcogoApp",[])}(),function(e){"use strict";function t(e){var t,a,o="http://bcgis.baltimorecountymd.gov/arcgis/rest/services/Geocoders/AddressPoint_NAD83/GeocodeServer",n=function(e,o){require(["esri/Map","esri/views/MapView","esri/symbols/PictureMarkerSymbol","esri/Graphic","esri/geometry/Point","dojo/domReady!"],function(n,r,i,s,d){t=new i({url:"http://dev.baltimorecountymd.gov/sebin/n/f/icon-marker-my-report.png",height:60,width:35}),a=new i({url:"http://dev.baltimorecountymd.gov/sebin/n/p/icon-marker-other.png",height:55,width:35});var u={basemap:"topo-vector"},c=new n(u),l={container:e,map:c,zoom:13,center:[-76.6063945,39.4001857]},p=new r(l);o(p,d,s)})},r=function(e,t){require(["esri/tasks/Locator","esri/geometry/Point"],function(a,n){var r={countryCode:"US",outSpatialReference:4269,url:o},i={location:new n(-76.6063945,39.4001857),text:e},s={responseType:"json"};new a(r).suggestLocations(i,s).then(function(e){var a=[];angular.forEach(e,function(e){a.push(e.text)}),t(a)},function(e){console.log("err",e)})})},i=function(e,t){require(["esri/tasks/Locator"],function(a){var n={countryCode:"US",outSpatialReference:4269,url:o},r={address:{"Single Line Input":e},f:"json"},i={responseType:"json"};new a(n).addressToLocations(r,i).then(function(e){if(e.length){var a=e.sort(d);t(a[0])}},function(e){console.log("err",e)})})},s=function(e,t,a,n){require(["esri/tasks/Locator","esri/geometry/Point"],function(r,i){var s=new i(e,t),d={countryCode:"US",outSpatialReference:4269,url:o},u=new r(d);u.locationToAddress(s).then(a,n)})},d=function(e,t){return e.score<t.score?1:e.score>t.score?-1:0};return{createMap:n,dropMarker:function(e,o,n,r,i){require(["esri/Graphic","esri/geometry/Point","dojo/domReady!"],function(s,d){var u=new d(o,n),c=new s(u,i?a:t);e.goTo(u,{animate:!0,duration:250}),r&&e.graphics.removeAll(),e.graphics.add(c)})},lookupAddress:i,reverseGeocode:s,suggestAddresses:r}}e.factory("mapService",["$http",t])}(angular.module("baltcogoApp")),function(e){"use strict";function t(e){function t(t,a,o){var n={headers:{"Content-Type":"application/json"}};e.post("https://testservices.baltimorecountymd.gov/api/baltcogo/createreport",t,n).then(function(e){a(e.data)},function(e){o(e)})}function a(t,a,o){e.get("//testservices.baltimorecountymd.gov/api/citysourced/getreport/"+t).then(function(e){a(e.data)},function(e){o(e)})}function o(t,a,o){var n={headers:{"Content-Type":"application/json"}};e.post("//ba224964:1000/api/citysourced/getreportsbylatlng",t,n).then(function(e){a(e.data)},function(e){o(e)})}return{post:t,getById:a,getNearby:o}}e.factory("reportService",["$http",t])}(angular.module("baltcogoApp")),function(e,t){"use strict";function a(e,a,o,n,r){function i(e){angular.forEach(b.categoryData,function(t){t.id===e?(b.category=t,b.loadSubCategories(t.id)):t.types&&angular.forEach(t.types,function(a){a.id===e&&(b.category=t,b.loadSubCategories(t.id),b.subCategory=a)})})}function s(){b.subCategory="",b.petType="",b.otherPetType="",b.petSex="",b.primaryColor="",b.primaryBreed="",b.animalDescription=""}function d(e,t){var a="";return angular.forEach(e,function(e){if(e.id===t)return a=e.name,!0}),a}function u(){var e=angular.element("#citysourced-reporter-form .panel:visible [required]"),t=e.length,o=e.filter(".ng-valid").length,n=a.citySourcedReporterForm.$$controls;return angular.forEach(n,function(e,t,a){e.$$element.closest(".panel").is(":visible")&&(e.$pristine&&e.$setDirty(),e.$untouched&&e.$setTouched(),e.$$element.is("#address")&&(angular.element("#map-latitude").is(".ng-invalid")||angular.element("#map-longitude").is(".ng-invalid"))&&e.$setValidity("required",!1))}),t===o}function c(e){b.address&&b.address.trim().length>3&&n.suggestAddresses(b.address,function(e){b.autocompleteResults=e})}function l(e){b.animalTypeData=e.data}function p(e){b.animalBreedData=e.data}function m(e){b.categoryData=e.data,S&&i(S)}function g(e){b.animalColorData=e.data}function y(){angular.element("#map").closest("cs-form-control").addClass("error"),a.citySourcedReporterForm.address.$setDirty(),b.address="",a.$apply()}function f(e){console.log(e)}function v(e){b.petTypeData=e.data}function h(e){13===(e.which||e.keyCode)&&e.preventDefault()}var C,b=this,S=1*t.getAsDictionary().categoryid;e.get("/sebin/y/z/animal-breeds.json").then(p,f),e.get("/sebin/u/t/animal-colors.json").then(g,f),e.get("/sebin/a/d/animal-types.json").then(l,f),e.get("/sebin/q/l/categories.json").then(m,f),e.get("/sebin/m/z/pet-types.json").then(v,f),b.isAnimal=!1,b.page=1,b.isDone=!1,b.isSuccess=!1,b.issueId="",b.isLoading=!1,b.map=n.createMap("map",function(e,t,o,r){C=e;var i=function(i){var s=i.mapPoint.longitude,d=i.mapPoint.latitude,u=new t(s,d),c=new o(u,r);b.longitude=s,b.latitude=d,e.graphics.removeAll(),e.graphics.add(c),n.reverseGeocode(s,d,function(e){b.address=e.address.Street+", "+e.address.City+", "+e.address.State,a.$apply()},function(t){e.graphics.removeAll(),y()})};e.on("click",i)}),angular.element("#citysourced-reporter-form").on("keyup keypress",h),angular.element("#address").on("keyup",c),b.fileReportClick=function(){if(u()){var e=[{name:"Category",id:b.category,value:d(b.categoryData,b.category)},{name:"SubCategory",id:b.subCategory,value:d(b.subCategories,b.subCategory)},{name:"Description",id:1*angular.element("#description").attr("data-cs-id"),value:b.description},{name:"Latitude",value:b.latitude},{name:"Longitude",value:b.longitude},{name:"FirstName",value:b.firstName},{name:"LastName",value:b.lastName},{name:"Email",value:b.email},{name:"DeviceNumber",value:b.deviceNumber}];if(b.locationDescription&&e.push({name:"Description Of Location",id:1*angular.element("#locationDescription").attr("data-cs-id"),value:b.locationDescription}),b.petType&&e.push({name:"Pet Type",id:b.petType.id,value:d(b.petTypeData,b.petType.id)}),b.petSex&&e.push({name:"Sex",id:b.petSex.id,value:d(b.sex,b.petSex.id)}),b.otherPetType&&e.push({name:"Other Pet Type",id:b.otherPetType,value:d(b.animalTypeData,b.otherPetType)}),b.primaryBreed&&e.push({name:"Primary Breed",id:b.primaryBreed,value:d(b.breeds,b.primaryBreed)}),b.primaryColor&&e.push({name:"Primary Color",id:b.primaryColor,value:d(b.animalColorData,b.primaryColor)}),b.animalDescription&&e.push({name:"Description Of Animal",id:1*angular.element("#animalDescription").attr("data-cs-id"),value:b.animalDescription}),b.streetAddress&&e.push({name:"Complainant Address",id:b.streetAddressId,value:b.streetAddress}),b.city&&e.push({name:"Complainant City",id:b.cityId,value:b.city}),b.state){var t=b.state.id?b.state.id:b.state;e.push({name:"Complainant State",id:t,value:d(b.states,t)})}b.zipCode&&e.push({name:"Complainant Zip Code",id:b.zipCodeId,value:b.zipCode}),b.isLoading=!0,b.isDone=!0,r.post(e,function(e){b.isLoading=!1,b.isSuccess=!0,b.issueId=JSON.parse(e).CsResponse.ReportId},function(e){b.isLoading=!1,console.log(e)})}},b.loadSubCategories=function(e){if(!e)return void(b.subCategories=[]);angular.forEach(b.categoryData,function(t){s(),t.id==e&&(b.subCategories=t.types,t.states&&(b.states=t.states,b.state=t.states[0]),t.fields&&(b.streetAddressId=t.fields.streetAddress,b.cityId=t.fields.city,b.zipCodeId=t.fields.zipCode),b.isAnimal="pets and animals"===t.name.toLowerCase())})},b.nextClick=function(){u()?b.page++:a.citySourcedReporterForm.$setSubmitted()},b.prevClick=function(){b.page--},b.trackBreed=function(){angular.element.each(b.animalBreedData,function(e,t){if(t.id===b.petType.id)return b.breeds=t.breeds?t.breeds:[],b.sex=t.sex,!0})},b.lookupAddress=function(e){b.address=e,b.autocompleteResults=[],n.lookupAddress(e,function(e){b.longitude=e.location.x,b.latitude=e.location.y,n.dropMarker(C,b.longitude,b.latitude,!0)})}}e.controller("BaltCoGoReporterCtrl",["$http","$scope","$timeout","mapService","reportService",a])}(angular.module("baltcogoApp"),baltimoreCounty.utility.querystringer),function(e,t){"use strict";function a(e,a,o,n,r){function i(e){m.status=e.Status,m.isOpen="On Hold"===e.IsOpen?"on-hold":e.IsOpen?"open":"closed",m.id=e.Id,m.issueType=e.IssueType,m.dateCreated=e.DateCreated,m.dateUpdated=e.DateUpdated,m.description=e.Description,m.comments=e.comments,c=e.Longitude,l=e.Latitude,n.reverseGeocode(c,l,u,function(e){console.log(e)}),n.createMap("map",s)}function s(e,t,n,i){p=e,m.isMapLoading=!1,a.$apply(),o(function(){var e=new Date;e.setDate(-90);var t={Latitude:l,Longitude:c,StartDate:e.toLocaleDateString("en-US")};r.getNearby(t,d,function(e){console.log(e)})},500)}function d(e){angular.forEach(e,function(e){n.dropMarker(p,e.Longitude,e.Latitude,!1,!0)}),n.dropMarker(p,c,l,!1,!1)}function u(e){m.address=e.address.Street+", "+e.address.City+", "+e.address.State,m.isLoading=!1,a.$apply()}var c,l,p,m=this,g=t.getAsDictionary().reportId;m.isError=!1,m.isLoading=!0,m.isMapLoading=!0,g&&function(e,t){r.getById(e,t,function(e){console.log(e)})}(g,i)}e.controller("BaltCoGoViewerCtrl",["$http","$scope","$timeout","mapService","reportService",a])}(angular.module("baltcogoApp"),baltimoreCounty.utility.querystringer);