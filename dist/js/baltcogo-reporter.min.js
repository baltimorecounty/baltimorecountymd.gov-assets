!function(){"use strict";angular.module("baltcogoApp",[])}(),function(e){function t(e){return function(t){return e.trustAsHtml(t)}}e.filter("safeHtml",["$sce",t])}(angular.module("baltcogoApp")),function(e,t){"use strict";var o={urls:{geocodeServer:t.urls.api.geocodeServer,suggestions:t.urls.api.suggestions,createReport:t.urls.api.createReport,getReport:t.urls.api.getReport,getReportLatLng:t.urls.api.getReportLatLng,json:{animalBreeds:t.urls.json.animalBreeds,animalColors:t.urls.json.animalColors,animalTypes:t.urls.json.animalTypes,categories:t.urls.json.categories,petTypes:t.urls.json.petTypes}},locations:{courtHouse:{latitude:t.locations.courtHouse.latitude,longitude:t.locations.courtHouse.longitude}}};e.constant("CONSTANTS",o)}(angular.module("baltcogoApp"),baltimoreCounty.constants.baltCoGo),function(e){function t(e,t){function o(e){return e.replace(", USA","")}var a,n=function(){a&&a.setMap(null)},r=function(e,t){return new google.maps.Map(document.getElementById(e),t)},i=function(e,t,o){a&&a.setMap(null),a=new google.maps.Marker({position:{lat:t,lng:o},map:e,icon:"/sebin/n/f/icon-marker-my-report.png",draggable:!1,animation:google.maps.Animation.DROP})},s=function(o,a,n,r){e.get(t.urls.geocodeServer+"/reverseGeocode?location=%7B%22x%22%3A"+a+"%2C+%22y%22%3A"+o+"%7D&f=pjson").then(n,r)},u=function(o,a){var n=encodeURIComponent(o);e.get(t.urls.suggestions+n).then(function(e){var t=[];angular.forEach(e.data,function(e){t.push({address:e.StreetAddress+", "+e.City+", "+e.Zip,longitude:e.Longitude,latitude:e.Latitude})}),a(t)},function(e){console.log(e)})};return{clearMarkers:n,createMap:r,createMarker:i,pan:function(e,t,o){e.panTo({lat:t,lng:o})},removeCountry:o,reverseGeocode:s,suggestAddresses:u}}e.factory("mapServiceComposite",["$http","CONSTANTS",t])}(angular.module("baltcogoApp")),function(e){"use strict";function t(e,t){function o(o,a,n){var r={headers:{"Content-Type":"application/json"}};e.post(t.urls.createReport,o,r).then(function(e){a(e.data)},function(e){n(e)})}function a(o,a,n){e.get(t.urls.getReport+o).then(function(e){a(e.data)},function(e){n(e)})}function n(o,a,n){var r={headers:{"Content-Type":"application/json"}};e.post(t.urls.getReportLatLng,o,r).then(function(e){a(e.data)},function(e){n(e)})}return{post:o,getById:a,getNearby:n}}e.factory("reportService",["$http","CONSTANTS",t])}(angular.module("baltcogoApp")),function(e,t,o){"use strict";function a(e,a,n,r,i,s,u){function l(){return O.page===N}function c(e){O.page+=e;var t=l(),o=O.shouldRequireLocation();t&&!o&&d(O.page+e);t&&n(y,500)}function d(e){O.latitude=s.locations.courtHouse.latitude,O.longitude=s.locations.courtHouse.longitude,O.page=e}function p(e,t){return!!e&&Object.prototype.hasOwnProperty.call(e,t)}function g(e){angular.forEach(O.categoryData,function(t){t.id===e?(O.category=t,O.loadSubCategories()):t.types&&angular.forEach(t.types,function(o){o.id===e&&(O.category=t,O.loadSubCategories(),O.subCategory=o)})})}function m(){O.subCategory=null,O.petType="",O.otherPetType="",O.petSex="",O.primaryColor="",O.primaryBreed="",O.animalDescription="",O.streetAddress="",O.city="",O.zipCode="",O.descriptionOfAnimalId=0,O.descriptionOfLocationId=0,O.otherDescriptionId=0,O.longitude=0,O.latitude=0}function f(e,t){var o="";return angular.forEach(e,function(e){return e.id===t&&(o=e.name,!0)}),o}function y(){var e=x.getCenter();google.maps.event.trigger(x,"resize"),x.setCenter(e)}function C(){var e=angular.element("#citysourced-reporter-form .panel:visible [required]"),t=e.length,o=a.citySourcedReporterForm.$$controls,n=!1,r=!0;angular.forEach(o,function(e){if(e.$$element.closest(".panel").is(":visible")){var t=e.$$element.is("#map-latitude"),o=e.$$element.is("#map-longitude"),a=e.$$element.is("#address"),i=0===O.latitude||0===O.longitude;e.$pristine&&e.$setDirty(),e.$untouched&&e.$setTouched(),(t||o||a)&&(n=!0,i&&(e.$setValidity("required",!1),r=!1))}});var i=e.filter(".ng-valid").length;return n?r:t===i}function h(e){var t=e.which||e.keyCode;if(40===t)return e.preventDefault(),void angular.element(".autocomplete-results button").first().focus();if(13!==t)if(46!==t&&8!==t||(O.longitude=0,O.latitude=0),O.address&&O.address.trim().length>3){var o=O.address.trim().split(","),n=o[0];r.suggestAddresses(n,function(e){O.autocompleteResults=e})}else O.autocompleteResults=[];else if(O.autocompleteResults.length>0){var i=angular.element(".autocomplete-results button").first();i.trigger("click"),a.$apply()}}function v(e){var t=e.which||e.keyCode,o=angular.element(e.target);o.is(".autocomplete-results button")&&(27===t&&angular.element(".autocomplete-results").is(":visible")&&(O.autocompleteResults=[],a.$apply()),e.preventDefault(),13!==t&&32!==t||o.trigger("click"),40===t&&o.parent().next().find("button").focus(),38===t&&o.parent().prev().find("button").focus())}function b(e){O.animalTypeData=e.data}function D(e){O.animalBreedData=e.data}function S(e){O.categoryData=e.data,w&&g(w)}function T(e){O.animalColorData=e.data}function A(e){console.log(e)}function L(e){var t=angular.element("#map").closest("cs-form-control"),o=a.citySourcedReporterForm.address;O.autocompleteResults=[],O.latitude=e.latLng.lat(),O.longitude=e.latLng.lng(),r.reverseGeocode(O.latitude,O.longitude,function(e){t.removeClass("error"),e.data.error?O.address=R(t,o):(r.createMarker(x,O.latitude,O.longitude),O.address=e.data.address.Street.toLowerCase()+", "+e.data.address.City.toLowerCase()+", "+e.data.address.State.toUpperCase())},function(){O.address=R(t,o)})}function R(e,t){return e.addClass("error"),t.$setDirty(),O.latitude=0,O.longitude=0,r.clearMarkers(),""}function I(e){O.petTypeData=e.data}function k(e){13===(e.which||e.keyCode)&&e.preventDefault()}var x,O=this,w=1*t.getAsDictionary().categoryid,N=2;O.isAnimal=!1,O.page=1,O.isDone=!1,O.isSuccess=!1,O.issueId="",O.isLoading=!1,O.latitude=0,O.longitude=0,O.category=0;var j={center:{lat:s.locations.courtHouse.latitude,lng:s.locations.courtHouse.longitude},scrollwheel:!1,zoom:14,mapTypeId:"roadmap",mapTypeControl:!1,streetViewControl:!1,gestureHandling:"greedy"};x=r.createMap("map",j),e.get(s.urls.json.animalBreeds).then(D,A),e.get(s.urls.json.animalColors).then(T,A),e.get(s.urls.json.animalTypes).then(b,A),e.get(s.urls.json.categories).then(S,A),e.get(s.urls.json.petTypes).then(I,A),google.maps.event.addListener(x,"click",L),angular.element(document).on("keyup keypress","#citysourced-reporter-form",k),angular.element(document).on("keyup","#address",h),angular.element(window).on("keydown",v),angular.element(document).on("click","#baltcogo-note-alert a",function(e){e.preventDefault();var t=$(this).attr("href"),o=u.location.origin+u.location.pathname+"?categoryID="+O.subCategory.id;u.history.pushState({},O.subCategory.name,o),window.location=t}),O.fileReportClick=function(){if(C()){var e=[{name:"Category",id:O.category.id,value:O.category.name},{name:"SubCategory",id:O.subCategory.id,value:O.subCategory.name},{name:"Description",id:O.descriptionId,value:O.description},{name:"Latitude",value:O.latitude},{name:"Longitude",value:O.longitude},{name:"FirstName",value:O.firstName},{name:"LastName",value:O.lastName},{name:"Email",value:O.email},{name:"DeviceNumber",value:o("phoneNumber",O.deviceNumber,"xxx-xxx-xxxx")}];O.otherDescription&&e.push({name:"Other Description",id:O.otherDescriptionId,value:O.otherDescription}),O.petType&&e.push({name:"Pet Type",id:O.petType.id,value:f(O.petTypeData,O.petType.id)}),O.petSex&&e.push({name:"Sex",id:O.petSex.id,value:f(O.sex,O.petSex.id)}),O.otherPetType&&e.push({name:"Other Pet Type",id:O.otherPetType,value:f(O.animalTypeData,O.otherPetType)}),O.primaryBreed&&e.push({name:"Primary Breed",id:O.primaryBreed,value:f(O.breeds,O.primaryBreed)}),O.primaryColor&&e.push({name:"Primary Color",id:O.primaryColor,value:f(O.animalColorData,O.primaryColor)}),O.animalDescription&&e.push({name:"Description Of Animal",id:1*angular.element("#animalDescription").attr("data-cs-id"),value:O.animalDescription}),O.streetAddress&&e.push({name:"Complainant Address",id:O.streetAddressId,value:O.streetAddress}),O.city&&e.push({name:"Complainant City",id:O.cityId,value:O.city}),O.zipCode&&e.push({name:"Complainant Zip Code",id:O.zipCodeId,value:O.zipCode}),O.isLoading=!0,O.isDone=!0,i.post(e,function(e){O.isLoading=!1,O.isSuccess=!0,O.issueId=JSON.parse(e).CsResponse.ReportId},function(e){O.isLoading=!1,console.log(e)})}},O.loadSubCategories=function(){if(!O.category)return void(O.subCategories=[]);angular.forEach(O.categoryData,function(e){m(),e.id===O.category.id&&(O.subCategories=e.types,e.states?(O.states=e.states,O.state=e.states[0]):O.states=[],e.fields&&(O.streetAddressId=e.fields.streetAddress,O.cityId=e.fields.city,O.zipCodeId=e.fields.zipCode),O.isAnimal=!!e.isAnimal,n(function(){e.descriptionOfAnimal&&(O.descriptionOfAnimalId=e.descriptionOfAnimal),e.descriptionOfLocation&&(O.descriptionOfLocationId=e.descriptionOfLocation),e.otherDescription&&(O.otherDescriptionId=e.otherDescription)},0),O.descriptionId=e.description)})},O.nextClick=function(){C()?c(1):a.citySourcedReporterForm.$setSubmitted()},O.prevClick=function(){c(-1)},O.setLocation=function(e,t,o){O.address=e.autocompleteResult.address,O.longitude=t,O.latitude=o,O.autocompleteResults=[],r.pan(x,o,t),r.createMarker(x,o,t)},O.shouldRequireLocation=function(){var e=p(O.category,"requiresLocation"),t=p(O.subCategory,"requiresLocation");return!e&&!t||(t?O.subCategory.requiresLocation:O.category.requiresLocation)},O.trackBreed=function(){angular.forEach(O.animalBreedData,function(e){e.id===O.petType.id&&(O.breeds=e.breeds?e.breeds:[],O.sex=e.sex)})}}e.controller("BaltCoGoReporterCtrl",["$http","$scope","$timeout","mapServiceComposite","reportService","CONSTANTS","$window",a])}(angular.module("baltcogoApp"),baltimoreCounty.utility.querystringer,baltimoreCounty.utility.format);