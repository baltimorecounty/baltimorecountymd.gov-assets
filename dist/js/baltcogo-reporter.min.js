!function(){"use strict";angular.module("baltcogoApp",[])}(),function(e){"use strict";var t={urls:{geocodeServer:"http://bcgis.baltimorecountymd.gov/arcgis/rest/services/Geocoders/CompositeGeocode_CS/GeocodeServer",suggestions:"//testservices.baltimorecountymd.gov/api/gis/addressLookup/",createReport:"http://localhost:1000/api/baltcogo/createreport",getReport:"//testservices.baltimorecountymd.gov/api/citysourced/getreport/",getReportLatLng:"//testservices.baltimorecountymd.gov/api/citysourced/getreportsbylatlng",json:{animalBreeds:"/sebin/y/a/animal-breeds.json",animalColors:"/sebin/u/u/animal-colors.json",animalTypes:"/sebin/a/e/animal-types.json",categories:"/sebin/q/m/categories.json",petTypes:"/sebin/m/a/pet-types.json"}}};e.constant("CONSTANTS",t)}(angular.module("baltcogoApp")),function(e){function t(e,t){function o(e){return e.replace(", USA","")}var a,n=t.urls.geocodeServer,r=function(e,t){return new google.maps.Map(document.getElementById(e),t)},i=function(e,t,o){a&&a.setMap(null),a=new google.maps.Marker({position:{lat:t,lng:o},map:e,icon:"/sebin/n/f/icon-marker-my-report.png",draggable:!1,animation:google.maps.Animation.DROP})},s=function(e,t,o,a){require(["esri/tasks/Locator","esri/geometry/Point"],function(r,i){var s=new i(t,e);new r({countryCode:"US",outSpatialReference:4269,url:n}).locationToAddress(s).then(o,a)})},u=function(o,a){var n=encodeURIComponent(o);e.get(t.urls.suggestions+n).then(function(e){var t=[];angular.forEach(e.data,function(e){t.push({address:e.StreetAddress+", "+e.City+", "+e.Zip,longitude:e.Longitude,latitude:e.Latitude})}),a(t)},function(e){console.log(e)})};return{createMap:r,createMarker:i,pan:function(e,t,o){e.panTo({lat:t,lng:o})},removeCountry:o,reverseGeocode:s,suggestAddresses:u}}e.factory("mapServiceComposite",["$http","CONSTANTS",t])}(angular.module("baltcogoApp")),function(e){"use strict";function t(e,t){function o(o,a,n){var r={headers:{"Content-Type":"application/json"}};e.post(t.urls.createReport,o,r).then(function(e){a(e.data)},function(e){n(e)})}function a(o,a,n){e.get(t.urls.getReport+o).then(function(e){a(e.data)},function(e){n(e)})}function n(o,a,n){var r={headers:{"Content-Type":"application/json"}};e.post(t.urls.getReportLatLng,o,r).then(function(e){a(e.data)},function(e){n(e)})}return{post:o,getById:a,getNearby:n}}e.factory("reportService",["$http","CONSTANTS",t])}(angular.module("baltcogoApp")),function(e,t){"use strict";function o(e,o,a,n,r,i){function s(e){angular.forEach(T.categoryData,function(t){t.id===e?(T.category=t,T.loadSubCategories()):t.types&&angular.forEach(t.types,function(o){o.id===e&&(T.category=t,T.loadSubCategories(),T.subCategory=o)})})}function u(){T.subCategory="",T.petType="",T.otherPetType="",T.petSex="",T.primaryColor="",T.primaryBreed="",T.animalDescription="",T.streetAddress="",T.city="",T.zipCode="",T.descriptionOfAnimalId=0,T.descriptionOfLocationId=0,T.otherDescriptionId=0}function l(e,t){var o="";return angular.forEach(e,function(e){return e.id===t&&(o=e.name,!0)}),o}function c(){var e=S.getCenter();google.maps.event.trigger(S,"resize"),S.setCenter(e)}function d(){var e=angular.element("#citysourced-reporter-form .panel:visible [required]"),t=e.length,a=e.filter(".ng-valid").length,n=o.citySourcedReporterForm.$$controls;return angular.forEach(n,function(e){e.$$element.closest(".panel").is(":visible")&&(e.$pristine&&e.$setDirty(),e.$untouched&&e.$setTouched(),e.$$element.is("#address")&&(0!==T.latitude&&0!==T.longitude||e.$setValidity("required",!1)))}),t===a}function p(e){var t=e.which||e.keyCode;if(40===t)return e.preventDefault(),void angular.element(".autocomplete-results button").first().focus();if(13!==t)T.address&&T.address.trim().length>3?n.suggestAddresses(T.address,function(e){T.autocompleteResults=e}):T.autocompleteResults=[];else if(T.autocompleteResults.length>0){var a=angular.element(".autocomplete-results button").first();a.trigger("click"),o.$apply()}}function g(e){var t=e.which||e.keyCode,a=angular.element(e.target);a.is(".autocomplete-results button")&&(27===t&&angular.element(".autocomplete-results").is(":visible")&&(T.autocompleteResults=[],o.$apply()),e.preventDefault(),13!==t&&32!==t||a.trigger("click"),40===t&&a.parent().next().find("button").focus(),38===t&&a.parent().prev().find("button").focus())}function m(e){T.animalTypeData=e.data}function f(e){T.animalBreedData=e.data}function y(e){T.categoryData=e.data,A&&s(A)}function v(e){T.animalColorData=e.data}function C(e){console.log(e)}function h(e){var t=angular.element("#map").closest("cs-form-control"),a=o.citySourcedReporterForm.address;T.autocompleteResults=[],T.latitude=e.latLng.lat(),T.longitude=e.latLng.lng(),n.reverseGeocode(T.latitude,T.longitude,function(e){t.removeClass("error"),n.createMarker(S,T.latitude,T.longitude),T.address=e.address.Street.toLowerCase()+", "+e.address.City.toLowerCase()+", "+e.address.State.toUpperCase(),o.$apply()},function(){t.addClass("error"),a.$setDirty(),T.address="",o.$apply()})}function b(e){T.petTypeData=e.data}function D(e){13===(e.which||e.keyCode)&&e.preventDefault()}var S,T=this,A=1*t.getAsDictionary().categoryid;T.isAnimal=!1,T.page=1,T.isDone=!1,T.isSuccess=!1,T.issueId="",T.isLoading=!1,T.latitude=0,T.longitude=0,T.category=0;var L={center:{lat:39.4003288,lng:-76.60652470000002},scrollwheel:!1,zoom:14,mapTypeId:"roadmap",mapTypeControl:!1,streetViewControl:!1};S=n.createMap("map",L),e.get(i.urls.json.animalBreeds).then(f,C),e.get(i.urls.json.animalColors).then(v,C),e.get(i.urls.json.animalTypes).then(m,C),e.get(i.urls.json.categories).then(y,C),e.get(i.urls.json.petTypes).then(b,C),google.maps.event.addListener(S,"click",h),angular.element(document).on("keyup keypress","#citysourced-reporter-form",D),angular.element(document).on("keyup","#address",p),angular.element(window).on("keydown",g),T.fileReportClick=function(){if(d()){var e=[{name:"Category",id:T.category.id,value:T.category.name},{name:"SubCategory",id:T.subCategory.id,value:T.subCategory.name},{name:"Description",id:T.descriptionId,value:T.description},{name:"Latitude",value:T.latitude},{name:"Longitude",value:T.longitude},{name:"FirstName",value:T.firstName},{name:"LastName",value:T.lastName},{name:"Email",value:T.email},{name:"DeviceNumber",value:T.deviceNumber}];T.locationDescription&&e.push({name:"Description Of Location",id:T.descriptionOfLocationId,value:T.locationDescription}),T.otherDescription&&e.push({name:"Other Description",id:T.otherDescriptionId,value:T.otherDescription}),T.petType&&e.push({name:"Pet Type",id:T.petType.id,value:l(T.petTypeData,T.petType.id)}),T.petSex&&e.push({name:"Sex",id:T.petSex.id,value:l(T.sex,T.petSex.id)}),T.otherPetType&&e.push({name:"Other Pet Type",id:T.otherPetType,value:l(T.animalTypeData,T.otherPetType)}),T.primaryBreed&&e.push({name:"Primary Breed",id:T.primaryBreed,value:l(T.breeds,T.primaryBreed)}),T.primaryColor&&e.push({name:"Primary Color",id:T.primaryColor,value:l(T.animalColorData,T.primaryColor)}),T.animalDescription&&e.push({name:"Description Of Animal",id:1*angular.element("#animalDescription").attr("data-cs-id"),value:T.animalDescription}),T.streetAddress&&e.push({name:"Complainant Address",id:T.streetAddressId,value:T.streetAddress}),T.city&&e.push({name:"Complainant City",id:T.cityId,value:T.city}),T.zipCode&&e.push({name:"Complainant Zip Code",id:T.zipCodeId,value:T.zipCode}),T.isLoading=!0,T.isDone=!0,r.post(e,function(e){T.isLoading=!1,T.isSuccess=!0,T.issueId=JSON.parse(e).CsResponse.ReportId},function(e){T.isLoading=!1,console.log(e)})}},T.loadSubCategories=function(){if(!T.category)return void(T.subCategories=[]);angular.forEach(T.categoryData,function(e){u(),e.id===T.category.id&&(T.subCategories=e.types,e.states?(T.states=e.states,T.state=e.states[0]):T.states=[],e.fields&&(T.streetAddressId=e.fields.streetAddress,T.cityId=e.fields.city,T.zipCodeId=e.fields.zipCode),T.isAnimal="pets and animals"===e.name.toLowerCase(),a(function(){e.descriptionOfAnimal&&(T.descriptionOfAnimalId=e.descriptionOfAnimal),e.descriptionOfLocation&&(T.descriptionOfLocationId=e.descriptionOfLocation),e.otherDescription&&(T.otherDescriptionId=e.otherDescription)},0),T.descriptionId=e.description)})},T.nextClick=function(){d()?(T.page+=1,2===T.page&&"Website"===T.category.name&&(T.latitude=39.4003288,T.longitude=-76.6087134,T.page=3),2===T.page&&setTimeout(c,500)):o.citySourcedReporterForm.$setSubmitted()},T.prevClick=function(){T.page-=1,2===T.page&&"Website"===T.category.name&&(T.latitude=39.4003288,T.longitude=-76.6087134,T.page=1),2===T.page&&setTimeout(c,500)},T.setLocation=function(e,t,o){T.address=e.autocompleteResult.address,T.longitude=t,T.latitude=o,T.autocompleteResults=[],n.pan(S,o,t),n.createMarker(S,o,t)},T.trackBreed=function(){angular.element.each(T.animalBreedData,function(e,t){return t.id===T.petType.id&&(T.breeds=t.breeds?t.breeds:[],T.sex=t.sex,!0)})}}e.controller("BaltCoGoReporterCtrl",["$http","$scope","$timeout","mapServiceComposite","reportService","CONSTANTS",o])}(angular.module("baltcogoApp"),baltimoreCounty.utility.querystringer);