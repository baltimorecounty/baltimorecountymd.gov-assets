!function(){"use strict";angular.module("baltcogoApp",["ngAnimate"])}(),function(e){function t(e){return function(t){return e.trustAsHtml(t)}}e.filter("safeHtml",["$sce",t])}(angular.module("baltcogoApp")),function(e,t){"use strict";var o={urls:{geocodeServer:t.urls.api.geocodeServer,suggestions:t.urls.api.suggestions,createReport:t.urls.api.createReport,getReport:t.urls.api.getReport,getReportLatLng:t.urls.api.getReportLatLng,json:{animalBreeds:t.urls.json.animalBreeds,animalColors:t.urls.json.animalColors,animalTypes:t.urls.json.animalTypes,categories:t.urls.json.categories,petTypes:t.urls.json.petTypes}},locations:{courtHouse:{latitude:t.locations.courtHouse.latitude,longitude:t.locations.courtHouse.longitude}}};e.constant("CONSTANTS",o)}(angular.module("baltcogoApp"),baltimoreCounty.constants.baltCoGo),function(e){function t(e,t){function o(e){return e.replace(", USA","")}var a,n=function(){a&&a.setMap(null)},r=function(e,t){return new google.maps.Map(document.getElementById(e),t)},i=function(e,t,o){a&&a.setMap(null),a=new google.maps.Marker({position:{lat:t,lng:o},map:e,icon:"/sebin/n/f/icon-marker-my-report.png",draggable:!1,animation:google.maps.Animation.DROP})},s=function(o,a,n,r){e.get(t.urls.geocodeServer+"/reverseGeocode?location=%7B%22x%22%3A"+a+"%2C+%22y%22%3A"+o+"%7D&f=pjson").then(n,r)},u=function(o,a){var n=encodeURIComponent(o);e.get(t.urls.suggestions+n).then(function(e){var t=[];angular.forEach(e.data,function(e){t.push({address:e.StreetAddress+", "+e.City+", "+e.Zip,longitude:e.Longitude,latitude:e.Latitude})}),a(t)},function(e){console.log(e)})};return{clearMarkers:n,createMap:r,createMarker:i,pan:function(e,t,o){e.panTo({lat:t,lng:o})},removeCountry:o,reverseGeocode:s,suggestAddresses:u}}e.factory("mapServiceComposite",["$http","CONSTANTS",t])}(angular.module("baltcogoApp")),function(e){"use strict";function t(e,t){function o(o,a,n){var r={headers:{"Content-Type":"application/json"}};e.post(t.urls.createReport,o,r).then(function(e){a(e.data)},function(e){n(e)})}function a(o,a,n){e.get(t.urls.getReport+o).then(function(e){a(e.data)},function(e){n(e)})}function n(o,a,n){var r={headers:{"Content-Type":"application/json"}};e.post(t.urls.getReportLatLng,o,r).then(function(e){a(e.data)},function(e){n(e)})}return{post:o,getById:a,getNearby:n}}e.factory("reportService",["$http","CONSTANTS",t])}(angular.module("baltcogoApp")),function(e,t,o){"use strict";function a(e,a,n,r,i,s,u){function l(){return w.page===j}function c(e){w.page+=e;var t=l(),o=w.shouldRequireLocation();t&&!o&&p(w.page+e);t&&n(C,500)}function d(e){e.preventDefault();var t=$(this).attr("href"),o=u.location.origin+u.location.pathname+"?categoryID="+w.subCategory.id;u.history.pushState({},w.subCategory.name,o),window.location=t}function p(e){w.latitude=s.locations.courtHouse.latitude,w.longitude=s.locations.courtHouse.longitude,w.page=e}function g(e,t){return!!e&&Object.prototype.hasOwnProperty.call(e,t)}function m(e){angular.forEach(w.categoryData,function(t){t.id===e?(w.category=t,w.loadSubCategories()):t.types&&angular.forEach(t.types,function(o){o.id===e&&(w.category=t,w.loadSubCategories(),w.subCategory=o)})})}function f(){w.subCategory=null,w.petType="",w.otherPetType="",w.petSex="",w.primaryColor="",w.primaryBreed="",w.animalDescription="",w.streetAddress="",w.city="",w.zipCode="",w.descriptionOfAnimalId=0,w.descriptionOfLocationId=0,w.otherDescriptionId=0,w.longitude=0,w.latitude=0}function y(e,t){var o="";return angular.forEach(e,function(e){return e.id===t&&(o=e.name,!0)}),o}function C(){var e=O.getCenter();google.maps.event.trigger(O,"resize"),O.setCenter(e)}function h(){var e=angular.element("#citysourced-reporter-form .panel:visible [required]"),t=e.length,o=a.citySourcedReporterForm.$$controls,n=!1,r=!0;angular.forEach(o,function(e){if(e.$$element.closest(".panel").is(":visible")){var t=e.$$element.is("#map-latitude"),o=e.$$element.is("#map-longitude"),a=e.$$element.is("#address"),i=0===w.latitude||0===w.longitude;e.$pristine&&e.$setDirty(),e.$untouched&&e.$setTouched(),(t||o||a)&&(n=!0,i&&(e.$setValidity("required",!1),r=!1))}});var i=e.filter(".ng-valid").length;return n?r:t===i}function v(e){var t=e.which||e.keyCode;if(40===t)return e.preventDefault(),void angular.element(".autocomplete-results button").first().focus();if(13!==t)if(46!==t&&8!==t||(w.longitude=0,w.latitude=0),w.address&&w.address.trim().length>3){var o=w.address.trim().split(","),n=o[0];r.suggestAddresses(n,function(e){w.autocompleteResults=e})}else w.autocompleteResults=[];else if(w.autocompleteResults.length>0){var i=angular.element(".autocomplete-results button").first();i.trigger("click"),a.$apply()}}function b(e){var t=e.which||e.keyCode,o=angular.element(e.target);o.is(".autocomplete-results button")&&(27===t&&angular.element(".autocomplete-results").is(":visible")&&(w.autocompleteResults=[],a.$apply()),e.preventDefault(),13!==t&&32!==t||o.trigger("click"),40===t&&o.parent().next().find("button").focus(),38===t&&o.parent().prev().find("button").focus())}function D(e){w.animalTypeData=e.data}function S(e){w.animalBreedData=e.data}function A(e){w.categoryData=e.data,N&&m(N)}function T(e){w.animalColorData=e.data}function L(e){console.log(e)}function R(e){var t=angular.element("#map").closest("cs-form-control"),o=a.citySourcedReporterForm.address;w.autocompleteResults=[],w.latitude=e.latLng.lat(),w.longitude=e.latLng.lng(),r.reverseGeocode(w.latitude,w.longitude,function(e){t.removeClass("error"),e.data.error?w.address=I(t,o):(r.createMarker(O,w.latitude,w.longitude),w.address=e.data.address.Street.toLowerCase()+", "+e.data.address.City.toLowerCase()+", "+e.data.address.State.toUpperCase())},function(){w.address=I(t,o)})}function I(e,t){return e.addClass("error"),t.$setDirty(),w.latitude=0,w.longitude=0,r.clearMarkers(),""}function k(e){w.petTypeData=e.data}function x(e){13===(e.which||e.keyCode)&&e.preventDefault()}var O,w=this,N=1*t.getAsDictionary().categoryid,j=2;w.isAnimal=!1,w.page=1,w.isDone=!1,w.isSuccess=!1,w.issueId="",w.isLoading=!1,w.latitude=0,w.longitude=0,w.category=0;var B={center:{lat:s.locations.courtHouse.latitude,lng:s.locations.courtHouse.longitude},scrollwheel:!1,zoom:14,mapTypeId:"roadmap",mapTypeControl:!1,streetViewControl:!1,gestureHandling:"greedy"};O=r.createMap("map",B),e.get(s.urls.json.animalBreeds).then(S,L),e.get(s.urls.json.animalColors).then(T,L),e.get(s.urls.json.animalTypes).then(D,L),e.get(s.urls.json.categories).then(A,L),e.get(s.urls.json.petTypes).then(k,L),google.maps.event.addListener(O,"click",R),angular.element(document).on("keyup keypress","#citysourced-reporter-form",x),angular.element(document).on("keyup","#address",v),angular.element(window).on("keydown",b),angular.element(document).on("click","#baltcogo-note-alert a",d),w.fileReportClick=function(){if(h()){var e=[{name:"Category",id:w.category.id,value:w.category.name},{name:"SubCategory",id:w.subCategory.id,value:w.subCategory.name},{name:"Description",id:w.descriptionId,value:w.description},{name:"Latitude",value:w.latitude},{name:"Longitude",value:w.longitude},{name:"FirstName",value:w.firstName},{name:"LastName",value:w.lastName},{name:"Email",value:w.email},{name:"DeviceNumber",value:o("phoneNumber",w.deviceNumber,"xxx-xxx-xxxx")}];w.otherDescription&&e.push({name:"Other Description",id:w.otherDescriptionId,value:w.otherDescription}),w.petType&&e.push({name:"Pet Type",id:w.petType.id,value:y(w.petTypeData,w.petType.id)}),w.petSex&&e.push({name:"Sex",id:w.petSex.id,value:y(w.sex,w.petSex.id)}),w.otherPetType&&e.push({name:"Other Pet Type",id:w.otherPetType,value:y(w.animalTypeData,w.otherPetType)}),w.primaryBreed&&e.push({name:"Primary Breed",id:w.primaryBreed,value:y(w.breeds,w.primaryBreed)}),w.primaryColor&&e.push({name:"Primary Color",id:w.primaryColor,value:y(w.animalColorData,w.primaryColor)}),w.animalDescription&&e.push({name:"Description Of Animal",id:1*angular.element("#animalDescription").attr("data-cs-id"),value:w.animalDescription}),w.streetAddress&&e.push({name:"Complainant Address",id:w.streetAddressId,value:w.streetAddress}),w.city&&e.push({name:"Complainant City",id:w.cityId,value:w.city}),w.zipCode&&e.push({name:"Complainant Zip Code",id:w.zipCodeId,value:w.zipCode}),w.isLoading=!0,w.isDone=!0,i.post(e,function(e){w.isLoading=!1,w.isSuccess=!0,w.issueId=JSON.parse(e).CsResponse.ReportId},function(e){w.isLoading=!1,console.log(e)})}},w.loadSubCategories=function(){if(!w.category)return void(w.subCategories=[]);angular.forEach(w.categoryData,function(e){f(),e.id===w.category.id&&(w.subCategories=e.types,e.states?(w.states=e.states,w.state=e.states[0]):w.states=[],e.fields&&(w.streetAddressId=e.fields.streetAddress,w.cityId=e.fields.city,w.zipCodeId=e.fields.zipCode),w.isAnimal=!!e.isAnimal,n(function(){e.descriptionOfAnimal&&(w.descriptionOfAnimalId=e.descriptionOfAnimal),e.descriptionOfLocation&&(w.descriptionOfLocationId=e.descriptionOfLocation),e.otherDescription&&(w.otherDescriptionId=e.otherDescription)},0),w.descriptionId=e.description)})},w.nextClick=function(){h()?c(1):a.citySourcedReporterForm.$setSubmitted()},w.prevClick=function(){c(-1)},w.setLocation=function(e,t,o){w.address=e.autocompleteResult.address,w.longitude=t,w.latitude=o,w.autocompleteResults=[],r.pan(O,o,t),r.createMarker(O,o,t)},w.shouldRequireLocation=function(){var e=g(w.category,"requiresLocation"),t=g(w.subCategory,"requiresLocation");return!e&&!t||(t?w.subCategory.requiresLocation:w.category.requiresLocation)},w.trackBreed=function(){angular.forEach(w.animalBreedData,function(e){e.id===w.petType.id&&(w.breeds=e.breeds?e.breeds:[],w.sex=e.sex)})}}e.controller("BaltCoGoReporterCtrl",["$http","$scope","$timeout","mapServiceComposite","reportService","CONSTANTS","$window",a])}(angular.module("baltcogoApp"),baltimoreCounty.utility.querystringer,baltimoreCounty.utility.format);